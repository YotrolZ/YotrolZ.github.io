<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<link rel="alternate" href="/atom.xml" title="YotrolZ" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0" />
<link rel="canonical" href="http://yotrolz.com/"/>

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0" />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138610487-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138610487-3');
</script><script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":"","latex":false};
</script>

    <title>YotrolZ</title>
  <meta name="generator" content="Hexo 5.2.0"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">YotrolZ</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">Home
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">Archives
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">YotrolZ</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            Tags
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            Categories
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><section id="posts" class="posts"><article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/82d040e4/">DYLD_PRINT_STATISTICS</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-03-05
        </span></div>
    </header>

    <div class="post-content"><p>æˆ‘ä»¬åœ¨é˜…è¯»ä¸€äº›å…³äºå¯åŠ¨ä¼˜åŒ–çš„æ–‡ç« çš„æ—¶å€™ï¼Œç»å¸¸èƒ½çœ‹åˆ°è¿™æ ·çš„åœºæ™¯ï¼š</p>
<blockquote>
<p>æ‰“å° main() ä¹‹å‰ç¨‹åºè€—æ—¶æ—¶é•¿</p>
</blockquote>
<p>å…·ä½“åšæ³•å°±ä½¿ç”¨åˆ°äº† <code>DYLD_PRINT_STATISTICS</code>,æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>Edit Scheme</code> -&gt; é€‰æ‹©<code>Arguments</code> -&gt; åœ¨<code>Environment Variables</code> ä¸­æ·»åŠ  name: <code>DYLD_PRINT_STATISTICS</code>  value: <code>YES</code></li>
</ul>
<p>æ­¤æ—¶è¿è¡Œç¨‹åºï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°å¦‚ä¸‹æ‰“å°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Total pre-main time: 644.58 milliseconds (100.0%)</span><br><span class="line">         dylib loading time:  32.92 milliseconds (5.1%)</span><br><span class="line">        rebase&#x2F;binding time: 429.93 milliseconds (66.6%)</span><br><span class="line">            ObjC setup time:  94.78 milliseconds (14.7%)</span><br><span class="line">           initializer time:  86.93 milliseconds (13.4%)</span><br><span class="line">           slowest intializers :</span><br><span class="line">             libSystem.B.dylib :   8.51 milliseconds (1.3%)</span><br><span class="line">               libobjc.A.dylib :  15.61 milliseconds (2.4%)</span><br><span class="line">    libMainThreadChecker.dylib :  51.92 milliseconds (8.0%)</span><br></pre></td></tr></table></figure>



<h2 id="DYLD-PRINT-STATISTICS-ç®€ä»‹"><a href="#DYLD-PRINT-STATISTICS-ç®€ä»‹" class="headerlink" title="DYLD_PRINT_STATISTICS ç®€ä»‹"></a>DYLD_PRINT_STATISTICS ç®€ä»‹</h2><p><code>DYLD_PRINT_STATISTICS</code>å…¶å®å°±æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ä¸º<code>YES</code>åï¼Œç³»ç»Ÿèƒ½ä¸ºæˆ‘ä»¬æ‰“å°äº†ä¸€äº›æ—¥å¿—ä¿¡æ¯ï¼›</p>
<h2 id="DYLD-PRINT-STATISTICS-åº•å±‚"><a href="#DYLD-PRINT-STATISTICS-åº•å±‚" class="headerlink" title="DYLD_PRINT_STATISTICS åº•å±‚"></a>DYLD_PRINT_STATISTICS åº•å±‚</h2><p>è¯´èµ·<code>DYLD_PRINT_STATISTICS</code>ç¯å¢ƒå˜é‡ï¼Œé‚£å°±ä¸€å®šè¦è¯´èµ·<code>ç¨‹åºçš„å¯åŠ¨è¿‡ç¨‹</code>ï¼Œåœ¨ç¨‹åºå¯åŠ¨è¿‡ç¨‹ä¸­(è¿™é‡Œç‰¹æŒ‡main()å‡½æ•°ä¹‹å‰)ï¼Œå°±æ¶‰åŠåˆ°äº†<code>dyld çš„åŠ è½½æµç¨‹</code>,å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼šå…·ä½“å¯ä»¥é˜…è¯» <code>dyld æºç </code>:ä½äº <a target="_blank" rel="noopener" href="https://opensource.apple.com/tarballs/dyld/">https://opensource.apple.com/tarballs/dyld/</a> æˆ–è€…ä¹Ÿå¯ä»¥å‚è€ƒä¸‹ä¹‹å‰çš„æ–‡ç« </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- è®¾ç½®ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</span><br><span class="line">- æ£€æŸ¥ç¯å¢ƒå˜é‡</span><br><span class="line">- åŠ è½½ shared cache</span><br><span class="line">- å°†dyldæœ¬èº«æ·»åŠ åˆ°UUIDåˆ—è¡¨</span><br><span class="line">- å®ä¾‹åŒ–ä¸»ç¨‹åº</span><br><span class="line">- é“¾æ¥ä¸»ç¨‹åº</span><br><span class="line">- é“¾æ¥ inserted libraries</span><br><span class="line">- è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–ç¨‹åº(initializeMainExecutable)</span><br><span class="line">- é€šçŸ¥ä¸€äº›ç›‘è§†è¿›ç¨‹è¯¥è¿›ç¨‹å°†è¦è¿›å…¥main()</span><br><span class="line">- æŸ¥æ‰¾ä¸»ç¨‹åºçš„å…¥å£</span><br></pre></td></tr></table></figure>

<h3 id="initializeMainExecutable"><a href="#initializeMainExecutable" class="headerlink" title="initializeMainExecutable()"></a>initializeMainExecutable()</h3><p><code>dyld</code> ä¸­ <code>initializeMainExecutable</code> æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initializeMainExecutable</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// record that we&#x27;ve reached this step</span></span><br><span class="line">    gLinkContext.startedInitializingMainExecutable = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// run initialzers for any inserted dylibs</span></span><br><span class="line">    ImageLoader::InitializerTimingList initializerTimes[allImagesCount()];</span><br><span class="line">    initializerTimes[<span class="number">0</span>].count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">size_t</span> rootCount = sImageRoots.size();</span><br><span class="line">    <span class="keyword">if</span> ( rootCount &gt; <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">1</span>; i &lt; rootCount; ++i) &#123;</span><br><span class="line">            sImageRoots[i]-&gt;runInitializers(gLinkContext, initializerTimes[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// run initializers for main executable and everything it brings up </span></span><br><span class="line">    sMainExecutable-&gt;runInitializers(gLinkContext, initializerTimes[<span class="number">0</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// register cxa_atexit() handler to run static terminators in all loaded images when this process exits</span></span><br><span class="line">    <span class="keyword">if</span> ( gLibSystemHelpers != <span class="literal">NULL</span> ) </span><br><span class="line">        (*gLibSystemHelpers-&gt;cxa_atexit)(&amp;runAllStaticTerminators, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dump info if requested</span></span><br><span class="line">    <span class="comment">// â¬‡ï¸ ğŸ””ğŸ””ğŸ”” è¿™é‡Œå°±æ˜¯æˆ‘ä»¬åˆ†æçš„é‡ç‚¹â—ï¸â—ï¸â—ï¸ </span></span><br><span class="line">    <span class="keyword">if</span> ( sEnv.DYLD_PRINT_STATISTICS )</span><br><span class="line">        ImageLoader::printStatistics((<span class="keyword">unsigned</span> <span class="keyword">int</span>)allImagesCount(), initializerTimes[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">if</span> ( sEnv.DYLD_PRINT_STATISTICS_DETAILS )</span><br><span class="line">        ImageLoaderMachO::printStatisticsDetails((<span class="keyword">unsigned</span> <span class="keyword">int</span>)allImagesCount(), initializerTimes[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="ImageLoader-printStatistics"><a href="#ImageLoader-printStatistics" class="headerlink" title="ImageLoader::printStatistics()"></a>ImageLoader::printStatistics()</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ImageLoader::printStatistics</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> imageCount, <span class="keyword">const</span> InitializerTimingList&amp; timingInfo)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">uint64_t</span> totalTime = fgTotalLoadLibrariesTime  + fgTotalRebaseTime + fgTotalBindTime + fgTotalWeakBindTime + fgTotalDOF + fgTotalInitTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint64_t</span> totalDyldTime = totalTime - fgTotalDebuggerPausedTime - fgTotalRebindCacheTime;</span><br><span class="line">    printTime(<span class="string">&quot;Total pre-main time&quot;</span>, totalDyldTime, totalDyldTime);</span><br><span class="line">    printTime(<span class="string">&quot;         dylib loading time&quot;</span>, fgTotalLoadLibrariesTime-fgTotalDebuggerPausedTime, totalDyldTime);</span><br><span class="line">    printTime(<span class="string">&quot;        rebase/binding time&quot;</span>, fgTotalRebaseTime+fgTotalBindTime+fgTotalWeakBindTime-fgTotalRebindCacheTime, totalDyldTime);</span><br><span class="line">    printTime(<span class="string">&quot;            ObjC setup time&quot;</span>, fgTotalObjCSetupTime, totalDyldTime);</span><br><span class="line">    printTime(<span class="string">&quot;           initializer time&quot;</span>, fgTotalInitTime-fgTotalObjCSetupTime, totalDyldTime);</span><br><span class="line">    dyld::<span class="built_in">log</span>(<span class="string">&quot;           slowest intializers :\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">uintptr_t</span> i=<span class="number">0</span>; i &lt; timingInfo.count; ++i) &#123;</span><br><span class="line">      <span class="keyword">uint64_t</span> t = timingInfo.images[i].initTime;</span><br><span class="line">      <span class="keyword">if</span> ( t*<span class="number">50</span> &lt; totalDyldTime )</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      dyld::<span class="built_in">log</span>(<span class="string">&quot;%30s &quot;</span>, timingInfo.images[i].shortName);</span><br><span class="line">      <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(timingInfo.images[i].shortName, <span class="string">&quot;libSystem.&quot;</span>, <span class="number">10</span>) == <span class="number">0</span> )</span><br><span class="line">        t -= fgTotalObjCSetupTime;</span><br><span class="line">        printTime(<span class="string">&quot;&quot;</span>, t, totalDyldTime);</span><br><span class="line">    &#125;</span><br><span class="line">    dyld::<span class="built_in">log</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç ä¸­çš„æ‰“å°ä¿¡æ¯æœç„¶ä¸æˆ‘ä»¬æ–‡ç« å¼€å§‹æ—¶è¿è¡Œç¨‹åºæ‰“å°çš„æ—¥å¿—ä¸€è‡´ã€‚</p>
<h2 id="dyld-ä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡"><a href="#dyld-ä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡" class="headerlink" title="dyld ä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡"></a>dyld ä¸­å®šä¹‰çš„ç¯å¢ƒå˜é‡</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// state of all environment variables dyld uses</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EnvironmentVariables</span> &#123;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> *    DYLD_FRAMEWORK_PATH;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> *    DYLD_FALLBACK_FRAMEWORK_PATH;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> *    DYLD_LIBRARY_PATH;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> *    DYLD_FALLBACK_LIBRARY_PATH;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> *    DYLD_INSERT_LIBRARIES;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> *    LD_LIBRARY_PATH;            <span class="comment">// for unix conformance</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> *    DYLD_VERSIONED_LIBRARY_PATH;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span> *    DYLD_VERSIONED_FRAMEWORK_PATH;</span><br><span class="line">    <span class="keyword">bool</span>                   DYLD_PRINT_LIBRARIES_POST_LAUNCH;</span><br><span class="line">    <span class="keyword">bool</span>                   DYLD_BIND_AT_LAUNCH;</span><br><span class="line">    <span class="keyword">bool</span>                   DYLD_PRINT_STATISTICS;</span><br><span class="line">    <span class="keyword">bool</span>                   DYLD_PRINT_STATISTICS_DETAILS;</span><br><span class="line">    <span class="keyword">bool</span>                   DYLD_PRINT_OPTS;</span><br><span class="line">    <span class="keyword">bool</span>                   DYLD_PRINT_ENV;</span><br><span class="line">    <span class="keyword">bool</span>                   DYLD_DISABLE_DOFS;</span><br><span class="line">    <span class="keyword">bool</span>                   hasOverride;</span><br><span class="line">                     <span class="comment">//    DYLD_SHARED_CACHE_DIR           ==&gt; sSharedCacheOverrideDir</span></span><br><span class="line">                     <span class="comment">//    DYLD_ROOT_PATH                  ==&gt; gLinkContext.rootPaths</span></span><br><span class="line">                     <span class="comment">//    DYLD_IMAGE_SUFFIX               ==&gt; gLinkContext.imageSuffix</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_OPTS                 ==&gt; gLinkContext.verboseOpts</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_ENV                  ==&gt; gLinkContext.verboseEnv</span></span><br><span class="line">                     <span class="comment">//    DYLD_FORCE_FLAT_NAMESPACE       ==&gt; gLinkContext.bindFlat</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_INITIALIZERS         ==&gt; gLinkContext.verboseInit</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_SEGMENTS             ==&gt; gLinkContext.verboseMapping</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_BINDINGS             ==&gt; gLinkContext.verboseBind</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_WEAK_BINDINGS        ==&gt; gLinkContext.verboseWeakBind</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_REBASINGS            ==&gt; gLinkContext.verboseRebase</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_DOFS                 ==&gt; gLinkContext.verboseDOF</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_APIS                 ==&gt; gLogAPIs</span></span><br><span class="line">                     <span class="comment">//    DYLD_IGNORE_PREBINDING          ==&gt; gLinkContext.prebindUsage</span></span><br><span class="line">                     <span class="comment">//    DYLD_PREBIND_DEBUG              ==&gt; gLinkContext.verbosePrebinding</span></span><br><span class="line">                     <span class="comment">//    DYLD_NEW_LOCAL_SHARED_REGIONS   ==&gt; gLinkContext.sharedRegionMode</span></span><br><span class="line">                     <span class="comment">//    DYLD_SHARED_REGION              ==&gt; gLinkContext.sharedRegionMode</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_WARNINGS             ==&gt; gLinkContext.verboseWarnings</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_RPATHS               ==&gt; gLinkContext.verboseRPaths</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_INTERPOSING          ==&gt; gLinkContext.verboseInterposing</span></span><br><span class="line">                     <span class="comment">//    DYLD_PRINT_LIBRARIES            ==&gt; gLinkContext.verboseLoading</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/993b4752/">å†è¯´iOSä¸­çš„Class</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-02-25
        </span></div>
    </header>

    <div class="post-content"><p>OBJCæºç åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://opensource.apple.com/tarballs/objc4/">https://opensource.apple.com/tarballs/objc4/</a></p>
<h2 id="objc-class"><a href="#objc-class" class="headerlink" title="objc_class"></a>objc_class</h2><p>è¯´èµ·iOSä¸­çš„Class, ç½‘ä¸Šä¸€å¤§æ¨çš„æ–‡ç« ï¼Œé‚£å¿…å®šä¼šæåˆ°<code>objc_class</code>,ä½ æ˜¯å¦è§è¿‡å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_class &#123;</span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !__OBJC2__</span></span><br><span class="line">    Class _Nullable super_class                              OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * _Nonnull name                               OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> version                                             OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> info                                                OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">long</span> instance_size                                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_ivar_list * _Nullable ivars                  OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_method_list * _Nullable * _Nullable methodLists                    OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_cache * _Nonnull cache                       OBJC2_UNAVAILABLE;</span><br><span class="line">    <span class="keyword">struct</span> objc_protocol_list * _Nullable protocols          OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">&#125; OBJC2_UNAVAILABLE;</span><br><span class="line"><span class="comment">/* Use `Class` instead of `struct objc_class *` */</span></span><br></pre></td></tr></table></figure>

<h3 id="OBJC2-UNAVAILABLEå’ŒOBJC2"><a href="#OBJC2-UNAVAILABLEå’ŒOBJC2" class="headerlink" title="OBJC2_UNAVAILABLEå’ŒOBJC2"></a>OBJC2_UNAVAILABLEå’Œ<strong>OBJC2</strong></h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Define __OBJC2__ for the benefit of our asm files.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __OBJC2__</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">if</span> TARGET_OS_OSX  &amp;&amp;  !TARGET_OS_IOSMAC  &amp;&amp;  __i386__</span></span><br><span class="line">        <span class="comment">// old ABI</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> __OBJC2__ 1</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OBJC2_UNAVAILABLE: unavailable in objc 2.0, deprecated in Leopard */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(OBJC2_UNAVAILABLE)</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">if</span> __OBJC2__</span></span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> OBJC2_UNAVAILABLE UNAVAILABLE_ATTRIBUTE</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">else</span></span></span><br><span class="line">        <span class="comment">/* plain C code also falls here, but this is close enough */</span></span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> OBJC2_UNAVAILABLE                                       \</span></span><br><span class="line">            __OSX_DEPRECATED(<span class="number">10.5</span>, <span class="number">10.5</span>, <span class="string">&quot;not available in __OBJC2__&quot;</span>) \</span><br><span class="line">            __IOS_DEPRECATED(<span class="number">2.0</span>, <span class="number">2.0</span>, <span class="string">&quot;not available in __OBJC2__&quot;</span>)   \</span><br><span class="line">            __TVOS_UNAVAILABLE __WATCHOS_UNAVAILABLE __BRIDGEOS_UNAVAILABLE</span><br><span class="line"><span class="meta">#   <span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨2006å¹´7æœˆè‹¹æœå…¨çƒå¼€å‘è€…ä¼šè®®ä¸­ï¼ŒAppleå®£å¸ƒäº†â€œObjective-C 2.0â€çš„å‘å¸ƒï¼Œå…¶å¢åŠ äº†â€œç°ä»£çš„åƒåœ¾æ”¶é›†ï¼Œè¯­æ³•æ”¹è¿›ï¼Œè¿è¡Œæ—¶æ€§èƒ½æ”¹è¿›ï¼Œä»¥åŠ64ä½æ”¯æŒâ€ã€‚</li>
<li>2007å¹´10æœˆå‘å¸ƒçš„Mac OS X v10.5ä¸­åŒ…å«äº†Objective-C 2.0çš„ç¼–è¯‘å™¨ã€‚</li>
</ul>
<p>ç”±æ­¤å¯è§ï¼šä¸Šè¿°<code>objc_class</code>ä»£ç åœ¨Objective-C 2.0ä¸­<code>å·²ç»è¿‡æœŸ</code>äº†;</p>
<h2 id="objc-object"><a href="#objc-object" class="headerlink" title="objc_object"></a>objc_object</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !OBJC_TYPES_DEFINED</span></span><br><span class="line"><span class="comment">/// An opaque type that represents an Objective-C class.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Represents an instance of a class.</span></span><br><span class="line"><span class="keyword">struct</span> objc_object &#123;</span><br><span class="line">    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// A pointer to an instance of a class.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object *<span class="keyword">id</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>


<h2 id="OBJC-TYPES-DEFINEDå’ŒOBJC-ISA-AVAILABILITY"><a href="#OBJC-TYPES-DEFINEDå’ŒOBJC-ISA-AVAILABILITY" class="headerlink" title="OBJC_TYPES_DEFINEDå’ŒOBJC_ISA_AVAILABILITY"></a>OBJC_TYPES_DEFINEDå’ŒOBJC_ISA_AVAILABILITY</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// objc-private.h 41è¡Œ</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> OBJC_TYPES_DEFINED 1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* OBJC_ISA_AVAILABILITY: `isa` will be deprecated or unavailable </span></span><br><span class="line"><span class="comment"> * in the future */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> !defined(OBJC_ISA_AVAILABILITY)</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">if</span> __OBJC2__</span></span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> OBJC_ISA_AVAILABILITY  __attribute__((deprecated))</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> OBJC_ISA_AVAILABILITY  <span class="comment">/* still available */</span></span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç”±æ­¤å¯è§ï¼šä¸Šè¿°<code>objc_object</code>ä¸­çš„ä»£ç ä¹Ÿæ˜¯<code>æ— æ•ˆçš„</code></p>
<p>äº†è§£äº†ä¸Šè¿°è¯´æ˜åï¼Œæˆ‘ä»¬å†æ¬¡çœ‹Runtimeæºç ï¼Œå°±è¦æ’é™¤éƒ¨åˆ†ä»£ç çš„å¹²æ‰°äº†</p>
<h2 id="å†è¯´-objc-class"><a href="#å†è¯´-objc-class" class="headerlink" title="å†è¯´ objc_class"></a>å†è¯´ objc_class</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// objc-runtime-new.h 1111è¡Œ</span></span><br><span class="line"><span class="keyword">struct</span> objc_class : objc_object &#123;</span><br><span class="line">    <span class="comment">// Class ISA;</span></span><br><span class="line">    Class superclass;</span><br><span class="line">    cache_t cache;             <span class="comment">// formerly cache pointer and vtable</span></span><br><span class="line">    class_data_bits_t bits;    <span class="comment">// class_rw_t * plus custom rr/alloc flags</span></span><br><span class="line"></span><br><span class="line">    class_rw_t *data() &#123; </span><br><span class="line">        <span class="keyword">return</span> bits.data();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setData(class_rw_t *newData) &#123;</span><br><span class="line">        bits.setData(newData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> setInfo(uint32_t set) &#123;</span><br><span class="line">        assert(isFuture()  ||  isRealized());</span><br><span class="line">        data()-&gt;setFlags(set);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> clearInfo(uint32_t clear) &#123;</span><br><span class="line">        assert(isFuture()  ||  isRealized());</span><br><span class="line">        data()-&gt;clearFlags(clear);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set and clear must not overlap</span></span><br><span class="line">    <span class="keyword">void</span> changeInfo(uint32_t set, uint32_t clear) &#123;</span><br><span class="line">        assert(isFuture()  ||  isRealized());</span><br><span class="line">        assert((set &amp; clear) == <span class="number">0</span>);</span><br><span class="line">        data()-&gt;changeFlags(set, clear);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> hasCustomRR() &#123;</span><br><span class="line">        <span class="keyword">return</span> ! bits.hasDefaultRR();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setHasDefaultRR() &#123;</span><br><span class="line">        assert(isInitializing());</span><br><span class="line">        bits.setHasDefaultRR();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setHasCustomRR(<span class="keyword">bool</span> inherited = <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">void</span> printCustomRR(<span class="keyword">bool</span> inherited);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> hasCustomAWZ() &#123;</span><br><span class="line">        <span class="keyword">return</span> ! bits.hasDefaultAWZ();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setHasDefaultAWZ() &#123;</span><br><span class="line">        assert(isInitializing());</span><br><span class="line">        bits.setHasDefaultAWZ();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setHasCustomAWZ(<span class="keyword">bool</span> inherited = <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">void</span> printCustomAWZ(<span class="keyword">bool</span> inherited);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> instancesRequireRawIsa() &#123;</span><br><span class="line">        <span class="keyword">return</span> bits.instancesRequireRawIsa();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setInstancesRequireRawIsa(<span class="keyword">bool</span> inherited = <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">void</span> printInstancesRequireRawIsa(<span class="keyword">bool</span> inherited);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> canAllocNonpointer() &#123;</span><br><span class="line">        assert(!isFuture());</span><br><span class="line">        <span class="keyword">return</span> !instancesRequireRawIsa();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> canAllocFast() &#123;</span><br><span class="line">        assert(!isFuture());</span><br><span class="line">        <span class="keyword">return</span> bits.canAllocFast();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> hasCxxCtor() &#123;</span><br><span class="line">        <span class="comment">// addSubclass() propagates this flag from the superclass.</span></span><br><span class="line">        assert(isRealized());</span><br><span class="line">        <span class="keyword">return</span> bits.hasCxxCtor();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setHasCxxCtor() &#123; </span><br><span class="line">        bits.setHasCxxCtor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> hasCxxDtor() &#123;</span><br><span class="line">        <span class="comment">// addSubclass() propagates this flag from the superclass.</span></span><br><span class="line">        assert(isRealized());</span><br><span class="line">        <span class="keyword">return</span> bits.hasCxxDtor();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setHasCxxDtor() &#123; </span><br><span class="line">        bits.setHasCxxDtor();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isSwiftStable() &#123;</span><br><span class="line">        <span class="keyword">return</span> bits.isSwiftStable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isSwiftLegacy() &#123;</span><br><span class="line">        <span class="keyword">return</span> bits.isSwiftLegacy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isAnySwift() &#123;</span><br><span class="line">        <span class="keyword">return</span> bits.isAnySwift();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return YES if the class&#x27;s ivars are managed by ARC, </span></span><br><span class="line">    <span class="comment">// or the class is MRC but has ARC-style weak ivars.</span></span><br><span class="line">    <span class="keyword">bool</span> hasAutomaticIvars() &#123;</span><br><span class="line">        <span class="keyword">return</span> data()-&gt;ro-&gt;flags &amp; (RO_IS_ARC | RO_HAS_WEAK_WITHOUT_ARC);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return YES if the class&#x27;s ivars are managed by ARC.</span></span><br><span class="line">    <span class="keyword">bool</span> isARC() &#123;</span><br><span class="line">        <span class="keyword">return</span> data()-&gt;ro-&gt;flags &amp; RO_IS_ARC;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> SUPPORT_NONPOINTER_ISA</span></span><br><span class="line">    <span class="comment">// Tracked in non-pointer isas; not tracked otherwise</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="keyword">bool</span> instancesHaveAssociatedObjects() &#123;</span><br><span class="line">        <span class="comment">// this may be an unrealized future class in the CF-bridged case</span></span><br><span class="line">        assert(isFuture()  ||  isRealized());</span><br><span class="line">        <span class="keyword">return</span> data()-&gt;flags &amp; RW_INSTANCES_HAVE_ASSOCIATED_OBJECTS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> setInstancesHaveAssociatedObjects() &#123;</span><br><span class="line">        <span class="comment">// this may be an unrealized future class in the CF-bridged case</span></span><br><span class="line">        assert(isFuture()  ||  isRealized());</span><br><span class="line">        setInfo(RW_INSTANCES_HAVE_ASSOCIATED_OBJECTS);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> shouldGrowCache() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> setShouldGrowCache(<span class="keyword">bool</span>) &#123;</span><br><span class="line">        <span class="comment">// fixme good or bad for memory use?</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isInitializing() &#123;</span><br><span class="line">        <span class="keyword">return</span> getMeta()-&gt;data()-&gt;flags &amp; RW_INITIALIZING;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> setInitializing() &#123;</span><br><span class="line">        assert(!isMetaClass());</span><br><span class="line">        ISA()-&gt;setInfo(RW_INITIALIZING);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isInitialized() &#123;</span><br><span class="line">        <span class="keyword">return</span> getMeta()-&gt;data()-&gt;flags &amp; RW_INITIALIZED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> setInitialized();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isLoadable() &#123;</span><br><span class="line">        assert(isRealized());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">// any class registered for +load is definitely loadable</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IMP getLoadMethod();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Locking: To prevent concurrent realization, hold runtimeLock.</span></span><br><span class="line">    <span class="keyword">bool</span> isRealized() &#123;</span><br><span class="line">        <span class="keyword">return</span> data()-&gt;flags &amp; RW_REALIZED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Returns true if this is an unrealized future class.</span></span><br><span class="line">    <span class="comment">// Locking: To prevent concurrent realization, hold runtimeLock.</span></span><br><span class="line">    <span class="keyword">bool</span> isFuture() &#123; </span><br><span class="line">        <span class="keyword">return</span> data()-&gt;flags &amp; RW_FUTURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isMetaClass() &#123;</span><br><span class="line">        assert(<span class="keyword">this</span>);</span><br><span class="line">        assert(isRealized());</span><br><span class="line">        <span class="keyword">return</span> data()-&gt;ro-&gt;flags &amp; RO_META;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// NOT identical to this-&gt;ISA when this is a metaclass</span></span><br><span class="line">    Class getMeta() &#123;</span><br><span class="line">        <span class="keyword">if</span> (isMetaClass()) <span class="keyword">return</span> (Class)<span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">this</span>-&gt;ISA();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> isRootClass() &#123;</span><br><span class="line">        <span class="keyword">return</span> superclass == <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> isRootMetaclass() &#123;</span><br><span class="line">        <span class="keyword">return</span> ISA() == (Class)<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *mangledName() &#123; </span><br><span class="line">        <span class="comment">// fixme can&#x27;t assert locks here</span></span><br><span class="line">        assert(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isRealized()  ||  isFuture()) &#123;</span><br><span class="line">            <span class="keyword">return</span> data()-&gt;ro-&gt;name;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> ((<span class="keyword">const</span> class_ro_t *)data())-&gt;name;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *demangledName(<span class="keyword">bool</span> realize = <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *nameForLogging();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// May be unaligned depending on class&#x27;s ivars.</span></span><br><span class="line">    uint32_t unalignedInstanceStart() &#123;</span><br><span class="line">        assert(isRealized());</span><br><span class="line">        <span class="keyword">return</span> data()-&gt;ro-&gt;instanceStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Class&#x27;s instance start rounded up to a pointer-size boundary.</span></span><br><span class="line">    <span class="comment">// This is used for ARC layout bitmaps.</span></span><br><span class="line">    uint32_t alignedInstanceStart() &#123;</span><br><span class="line">        <span class="keyword">return</span> word_align(unalignedInstanceStart());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// May be unaligned depending on class&#x27;s ivars.</span></span><br><span class="line">    uint32_t unalignedInstanceSize() &#123;</span><br><span class="line">        assert(isRealized());</span><br><span class="line">        <span class="keyword">return</span> data()-&gt;ro-&gt;instanceSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Class&#x27;s ivar size rounded up to a pointer-size boundary.</span></span><br><span class="line">    uint32_t alignedInstanceSize() &#123;</span><br><span class="line">        <span class="keyword">return</span> word_align(unalignedInstanceSize());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    size_t instanceSize(size_t extraBytes) &#123;</span><br><span class="line">        size_t size = alignedInstanceSize() + extraBytes;</span><br><span class="line">        <span class="comment">// CF requires all objects be at least 16 bytes.</span></span><br><span class="line">        <span class="keyword">if</span> (size &lt; <span class="number">16</span>) size = <span class="number">16</span>;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> setInstanceSize(uint32_t newSize) &#123;</span><br><span class="line">        assert(isRealized());</span><br><span class="line">        <span class="keyword">if</span> (newSize != data()-&gt;ro-&gt;instanceSize) &#123;</span><br><span class="line">            assert(data()-&gt;flags &amp; RW_COPIED_RO);</span><br><span class="line">            *const_cast&lt;uint32_t *&gt;(&amp;data()-&gt;ro-&gt;instanceSize) = newSize;</span><br><span class="line">        &#125;</span><br><span class="line">        bits.setFastInstanceSize(newSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> chooseClassArrayIndex();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> setClassArrayIndex(<span class="keyword">unsigned</span> Idx) &#123;</span><br><span class="line">        bits.setClassArrayIndex(Idx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> classArrayIndex() &#123;</span><br><span class="line">        <span class="keyword">return</span> bits.classArrayIndex();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="objc-object-1"><a href="#objc-object-1" class="headerlink" title="objc_object"></a>objc_object</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_object &#123;</span><br><span class="line">private:</span><br><span class="line">    isa_t isa;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    <span class="comment">// isaç›¸å…³æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// ISA() assumes this is NOT a tagged pointer object</span></span><br><span class="line">    Class ISA();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// getIsa() allows this to be a tagged pointer object</span></span><br><span class="line">    Class getIsa();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// initIsa() should be used to init the isa of new objects only.</span></span><br><span class="line">    <span class="comment">// If this object already has an isa, use changeIsa() for correctness.</span></span><br><span class="line">    <span class="comment">// initInstanceIsa(): objects with no custom RR/AWZ</span></span><br><span class="line">    <span class="comment">// initClassIsa(): class objects</span></span><br><span class="line">    <span class="comment">// initProtocolIsa(): protocol objects</span></span><br><span class="line">    <span class="comment">// initIsa(): other objects</span></span><br><span class="line">    <span class="keyword">void</span> initIsa(Class cls <span class="comment">/*nonpointer=false*/</span>);</span><br><span class="line">    <span class="keyword">void</span> initClassIsa(Class cls <span class="comment">/*nonpointer=maybe*/</span>);</span><br><span class="line">    <span class="keyword">void</span> initProtocolIsa(Class cls <span class="comment">/*nonpointer=maybe*/</span>);</span><br><span class="line">    <span class="keyword">void</span> initInstanceIsa(Class cls, <span class="keyword">bool</span> hasCxxDtor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// changeIsa() should be used to change the isa of existing objects.</span></span><br><span class="line">    <span class="comment">// If this is a new object, use initIsa() for performance.</span></span><br><span class="line">    Class changeIsa(Class newCls);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> hasNonpointerIsa();</span><br><span class="line">    <span class="keyword">bool</span> isTaggedPointer();</span><br><span class="line">    <span class="keyword">bool</span> isBasicTaggedPointer();</span><br><span class="line">    <span class="keyword">bool</span> isExtTaggedPointer();</span><br><span class="line">    <span class="keyword">bool</span> isClass();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…³è”å¯¹è±¡ç›¸å…³æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// object may have associated objects?</span></span><br><span class="line">    <span class="keyword">bool</span> hasAssociatedObjects();</span><br><span class="line">    <span class="keyword">void</span> setHasAssociatedObjects();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼±å¼•ç”¨ç›¸å…³æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// object may be weakly referenced?</span></span><br><span class="line">    <span class="keyword">bool</span> isWeaklyReferenced();</span><br><span class="line">    <span class="keyword">void</span> setWeaklyReferenced_nolock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// object may have -.cxx_destruct implementation?</span></span><br><span class="line">    <span class="keyword">bool</span> hasCxxDtor();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…å­˜ç®¡ç†ç›¸å…³æ–¹æ³•</span></span><br><span class="line">    <span class="comment">// Optimized calls to retain/release methods</span></span><br><span class="line">    <span class="keyword">id</span> <span class="keyword">retain</span>();</span><br><span class="line">    <span class="keyword">void</span> release();</span><br><span class="line">    <span class="keyword">id</span> autorelease();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Implementations of retain/release methods</span></span><br><span class="line">    <span class="keyword">id</span> rootRetain();</span><br><span class="line">    <span class="keyword">bool</span> rootRelease();</span><br><span class="line">    <span class="keyword">id</span> rootAutorelease();</span><br><span class="line">    <span class="keyword">bool</span> rootTryRetain();</span><br><span class="line">    <span class="keyword">bool</span> rootReleaseShouldDealloc();</span><br><span class="line">    uintptr_t rootRetainCount();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Implementation of dealloc methods</span></span><br><span class="line">    <span class="keyword">bool</span> rootIsDeallocating();</span><br><span class="line">    <span class="keyword">void</span> clearDeallocating();</span><br><span class="line">    <span class="keyword">void</span> rootDealloc();</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    <span class="keyword">void</span> initIsa(Class newCls, <span class="keyword">bool</span> nonpointer, <span class="keyword">bool</span> hasCxxDtor);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Slow paths for inline control</span></span><br><span class="line">    <span class="keyword">id</span> rootAutorelease2();</span><br><span class="line">    <span class="keyword">bool</span> overrelease_error();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> SUPPORT_NONPOINTER_ISA</span></span><br><span class="line">    <span class="comment">// Unified retain count manipulation for nonpointer isa</span></span><br><span class="line">    <span class="keyword">id</span> rootRetain(<span class="keyword">bool</span> tryRetain, <span class="keyword">bool</span> handleOverflow);</span><br><span class="line">    <span class="keyword">bool</span> rootRelease(<span class="keyword">bool</span> performDealloc, <span class="keyword">bool</span> handleUnderflow);</span><br><span class="line">    <span class="keyword">id</span> rootRetain_overflow(<span class="keyword">bool</span> tryRetain);</span><br><span class="line">    <span class="keyword">bool</span> rootRelease_underflow(<span class="keyword">bool</span> performDealloc);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> clearDeallocating_slow();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Side table retain count overflow for nonpointer isa</span></span><br><span class="line">    <span class="keyword">void</span> sidetable_lock();</span><br><span class="line">    <span class="keyword">void</span> sidetable_unlock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> sidetable_moveExtraRC_nolock(size_t extra_rc, <span class="keyword">bool</span> isDeallocating, <span class="keyword">bool</span> weaklyReferenced);</span><br><span class="line">    <span class="keyword">bool</span> sidetable_addExtraRC_nolock(size_t delta_rc);</span><br><span class="line">    size_t sidetable_subExtraRC_nolock(size_t delta_rc);</span><br><span class="line">    size_t sidetable_getExtraRC_nolock();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Side-table-only retain count</span></span><br><span class="line">    <span class="keyword">bool</span> sidetable_isDeallocating();</span><br><span class="line">    <span class="keyword">void</span> sidetable_clearDeallocating();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> sidetable_isWeaklyReferenced();</span><br><span class="line">    <span class="keyword">void</span> sidetable_setWeaklyReferenced_nolock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">id</span> sidetable_retain();</span><br><span class="line">    <span class="keyword">id</span> sidetable_retain_slow(SideTable&amp; table);</span><br><span class="line"></span><br><span class="line">    uintptr_t sidetable_release(<span class="keyword">bool</span> performDealloc = <span class="literal">true</span>);</span><br><span class="line">    uintptr_t sidetable_release_slow(SideTable&amp; table, <span class="keyword">bool</span> performDealloc = <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> sidetable_tryRetain();</span><br><span class="line"></span><br><span class="line">    uintptr_t sidetable_retainCount();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line">    <span class="keyword">bool</span> sidetable_present();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/687bc3c9/">iOS ç¨‹åºå¯åŠ¨ä¸dyldåŠ è½½</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-03-04
        </span></div>
    </header>

    <div class="post-content"><p>ä¼—æ‰€å‘¨çŸ¥ï¼šæˆ‘ä»¬iOSç¨‹åºçš„å…¥å£æ˜¯<code>main.m</code>ä¸­çš„<code>main()</code>å‡½æ•°</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;AppDelegate.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> * appDelegateClassName;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£å¦‚æœæˆ‘ä»¬åœ¨mainå‡½æ•°ä¸­æ‰“ä¸Šæ–­ç‚¹</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mian.m</span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> * appDelegateClassName; <span class="comment">// â¬…ï¸ æ–­ç‚¹â‘ </span></span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="comment">// Setup code that might create autoreleased objects goes here.</span></span><br><span class="line">        appDelegateClassName = <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, appDelegateClassName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AppDelegate.m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;AppDelegate load&quot;</span>); <span class="comment">// â¬…ï¸ æ–­ç‚¹â‘¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶è¿è¡Œç¨‹åºï¼Œå‘ç°æˆ‘ä»¬å…ˆå¡åœ¨äº†<code>æ–­ç‚¹â‘¡</code>, æˆ‘ä»¬è¿›å…¥LLDB è¾“å…¥<code>bt</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(lldb) bt</span><br><span class="line">* thread #1, queue = &#x27;com.apple.main-thread&#x27;, stop reason = breakpoint 2.1</span><br><span class="line">  * frame #<span class="number">0</span>:  <span class="number">0x000000010eb8e0a7</span> dyld`+[AppDelegate load](self=AppDelegate, _cmd=<span class="string">&quot;load&quot;</span>) at AppDelegate.m:<span class="number">17</span>:<span class="number">5</span></span><br><span class="line">    frame #<span class="number">1</span>:  <span class="number">0x00007fff201804e3</span> libobjc.A.dylib`load_images + <span class="number">1442</span></span><br><span class="line">    frame #<span class="number">2</span>:  <span class="number">0x000000010eba1e54</span> dyld_sim`dyld::notifySingle(dyld_image_states, ImageLoader <span class="keyword">const</span>*, ImageLoader::InitializerTimingList*) + <span class="number">425</span></span><br><span class="line">    frame #<span class="number">3</span>:  <span class="number">0x000000010ebb0887</span> dyld_sim`ImageLoader::recursiveInitialization(ImageLoader::LinkContext <span class="keyword">const</span>&amp;, <span class="keyword">unsigned</span> <span class="keyword">int</span>, <span class="keyword">char</span> <span class="keyword">const</span>*, ImageLoader::InitializerTimingList&amp;, ImageLoader::UninitedUpwards&amp;) + <span class="number">437</span></span><br><span class="line">    frame #<span class="number">4</span>:  <span class="number">0x000000010ebaebb0</span> dyld_sim`ImageLoader::processInitializers(ImageLoader::LinkContext <span class="keyword">const</span>&amp;, <span class="keyword">unsigned</span> <span class="keyword">int</span>, ImageLoader::InitializerTimingList&amp;, ImageLoader::UninitedUpwards&amp;) + <span class="number">188</span></span><br><span class="line">    frame #<span class="number">5</span>:  <span class="number">0x000000010ebaec50</span> dyld_sim`ImageLoader::runInitializers(ImageLoader::LinkContext <span class="keyword">const</span>&amp;, ImageLoader::InitializerTimingList&amp;) + <span class="number">82</span></span><br><span class="line">    frame #<span class="number">6</span>:  <span class="number">0x000000010eba22a9</span> dyld_sim`dyld::initializeMainExecutable() + <span class="number">199</span></span><br><span class="line">    frame #<span class="number">7</span>:  <span class="number">0x000000010eba6d50</span> dyld_sim`dyld::_main(macho_header <span class="keyword">const</span>*, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">int</span>, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">unsigned</span> <span class="keyword">long</span>*) + <span class="number">4431</span></span><br><span class="line">    frame #<span class="number">8</span>:  <span class="number">0x000000010eba11c7</span> dyld_sim`start_sim + <span class="number">122</span></span><br><span class="line">    frame #<span class="number">9</span>:  <span class="number">0x0000000116e7057a</span> dyld`dyld::useSimulatorDyld(<span class="keyword">int</span>, macho_header <span class="keyword">const</span>*, <span class="keyword">char</span> <span class="keyword">const</span>*, <span class="keyword">int</span>, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">unsigned</span> <span class="keyword">long</span>*, <span class="keyword">unsigned</span> <span class="keyword">long</span>*) + <span class="number">2093</span></span><br><span class="line">    frame #<span class="number">10</span>: <span class="number">0x0000000116e6ddf3</span> dyld`dyld::_main(macho_header <span class="keyword">const</span>*, <span class="keyword">unsigned</span> <span class="keyword">long</span>, <span class="keyword">int</span>, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">char</span> <span class="keyword">const</span>**, <span class="keyword">unsigned</span> <span class="keyword">long</span>*) + <span class="number">1199</span></span><br><span class="line">    frame #<span class="number">11</span>: <span class="number">0x0000000116e6822b</span> dyld`dyldbootstrap::start(dyld3::MachOLoaded <span class="keyword">const</span>*, <span class="keyword">int</span>, <span class="keyword">char</span> <span class="keyword">const</span>**, dyld3::MachOLoaded <span class="keyword">const</span>*, <span class="keyword">unsigned</span> <span class="keyword">long</span>*) + <span class="number">457</span></span><br><span class="line">    frame #<span class="number">12</span>: <span class="number">0x0000000116e68025</span> dyld`_dyld_start + <span class="number">37</span></span><br><span class="line">(lldb) </span><br></pre></td></tr></table></figure>

<p>ç”±æ­¤å¯è§ï¼Œåœ¨æˆ‘ä»¬çš„main()å‡½æ•°ä¹‹å‰ï¼Œæ‰§è¡Œäº†ä¸€ç³»åˆ—çš„æ“ä½œï¼Œæ¯”å¦‚åŠ è½½ç±»(è°ƒç”¨ <code>+load()</code>)ç­‰ï¼Œä¸€å¤§æ¨çš„<code>dyld</code>çš„å­—çœ¼ï¼Œæˆ‘ä»¬ä¸‹é¢å°±ä»‹ç»ä¸€ä¸‹è¿™ä¸ªç¥ç§˜çš„<code>dyld</code></p>
<h2 id="dyld-ç®€ä»‹"><a href="#dyld-ç®€ä»‹" class="headerlink" title="dyld ç®€ä»‹"></a>dyld ç®€ä»‹</h2><ul>
<li><p>dyld(The dynamic link editor)åŠ¨æ€é“¾æ¥ç¼–è¾‘å™¨ï¼Œæ˜¯æ“ä½œç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨ macOS ç³»ç»Ÿä¸­ï¼Œdyld ä½äº <code>Macintosh HD/usr/lib/dyld</code>ã€‚ </p>
</li>
<li><p>dyld æºç æ˜¯å¼€æºçš„ï¼Œä½äº <a target="_blank" rel="noopener" href="https://opensource.apple.com/tarballs/dyld/">https://opensource.apple.com/tarballs/dyld/</a></p>
</li>
</ul>
<h2 id="dyld-æ‰§è¡Œæµç¨‹"><a href="#dyld-æ‰§è¡Œæµç¨‹" class="headerlink" title="dyld æ‰§è¡Œæµç¨‹"></a>dyld æ‰§è¡Œæµç¨‹</h2><p>æ ¹æ®æ–‡å¤´<code>LLDB bt</code> ä¿¡æ¯å¾—çŸ¥ï¼šdyld çš„å…¥å£æ˜¯ <code>_dyld_start</code></p>
<h3 id="dyld-start"><a href="#dyld-start" class="headerlink" title="_dyld_start"></a>_dyld_start</h3><p>ä»¥ <code>arm64</code> ä¸ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#if __arm64__</span><br><span class="line">	.text</span><br><span class="line">	.align 2</span><br><span class="line">	.globl __dyld_start</span><br><span class="line">__dyld_start:</span><br><span class="line">	mov 	x28, sp</span><br><span class="line">	and     sp, x28, #~15		&#x2F;&#x2F; force 16-byte alignment of stack</span><br><span class="line">	mov	x0, #0</span><br><span class="line">	mov	x1, #0</span><br><span class="line">	stp	x1, x0, [sp, #-16]!	&#x2F;&#x2F; make aligned terminating frame</span><br><span class="line">	mov	fp, sp			&#x2F;&#x2F; set up fp to point to terminating frame</span><br><span class="line">	sub	sp, sp, #16             &#x2F;&#x2F; make room for local variables</span><br><span class="line">#if __LP64__</span><br><span class="line">	ldr     x0, [x28]               &#x2F;&#x2F; get app&#39;s mh into x0</span><br><span class="line">	ldr     x1, [x28, #8]           &#x2F;&#x2F; get argc into x1 (kernel passes 32-bit int argc as 64-bits on stack to keep alignment)</span><br><span class="line">	add     x2, x28, #16            &#x2F;&#x2F; get argv into x2</span><br><span class="line">#else</span><br><span class="line">	ldr     w0, [x28]               &#x2F;&#x2F; get app&#39;s mh into x0</span><br><span class="line">	ldr     w1, [x28, #4]           &#x2F;&#x2F; get argc into x1 (kernel passes 32-bit int argc as 64-bits on stack to keep alignment)</span><br><span class="line">	add     w2, w28, #8             &#x2F;&#x2F; get argv into x2</span><br><span class="line">#endif</span><br><span class="line">	adrp	x3,___dso_handle@page</span><br><span class="line">	add 	x3,x3,___dso_handle@pageoff &#x2F;&#x2F; get dyld&#39;s mh in to x4</span><br><span class="line">	mov	x4,sp                   &#x2F;&#x2F; x5 has &amp;startGlue</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; call dyldbootstrap::start(app_mh, argc, argv, dyld_mh, &amp;startGlue)</span><br><span class="line">	&#x2F;&#x2F; æ ¹æ® LLDB bt åŠä¸Šè¿°æ³¨é‡Šï¼Œè¿™é‡Œè°ƒç”¨äº† dyldbootstrap::start</span><br><span class="line">	bl	__ZN13dyldbootstrap5startEPKN5dyld311MachOLoadedEiPPKcS3_Pm</span><br><span class="line">	mov	x16,x0                  &#x2F;&#x2F; save entry point address in x16</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; çœç•¥éƒ¨åˆ†ä»£ç ...</span><br><span class="line"></span><br><span class="line">#endif &#x2F;&#x2F; __arm64__</span><br></pre></td></tr></table></figure>

<h3 id="dyldbootstrap-start"><a href="#dyldbootstrap-start" class="headerlink" title="dyldbootstrap::start"></a>dyldbootstrap::start</h3><p>ä½äº å‘½åç©ºé—´ <code>namespace dyldbootstrap</code> ä¸‹çš„ start æ–¹æ³•</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  This is code to bootstrap dyld.  This work in normally done for a program by dyld and crt.</span></span><br><span class="line"><span class="comment">//  In dyld we have to do this manually.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="function"><span class="keyword">uintptr_t</span> <span class="title">start</span><span class="params">(<span class="keyword">const</span> dyld3::MachOLoaded* appsMachHeader, <span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span>* argv[],</span></span></span><br><span class="line"><span class="function"><span class="params">				<span class="keyword">const</span> dyld3::MachOLoaded* dyldsMachHeader, <span class="keyword">uintptr_t</span>* startGlue)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Emit kdebug tracepoint to indicate dyld bootstrap has started &lt;rdar://46878536&gt;</span></span><br><span class="line">    dyld3::kdebug_trace_dyld_marker(DBG_DYLD_TIMING_BOOTSTRAP_START, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// if kernel had to slide dyld, we need to fix up load sensitive locations</span></span><br><span class="line">    <span class="comment">// we have to do this before using any global variables</span></span><br><span class="line">    <span class="comment">// åœ°å€æ¢å¤</span></span><br><span class="line">    rebaseDyld(dyldsMachHeader);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// kernel sets up env pointer to be just past end of agv array</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>** envp = &amp;argv[argc+<span class="number">1</span>];</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// kernel sets up apple pointer to be just past end of envp array</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>** apple = envp;</span><br><span class="line">    <span class="keyword">while</span>(*apple != <span class="literal">NULL</span>) &#123; ++apple; &#125;</span><br><span class="line">    ++apple;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set up random value for stack canary</span></span><br><span class="line">    __guard_setup(apple);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* DYLD_INITIALIZER_SUPPORT çš„å®šä¹‰</span></span><br><span class="line"><span class="comment">// currently dyld has no initializers, but if some come back, set this to non-zero</span></span><br><span class="line"><span class="comment">#define DYLD_INITIALIZER_SUPPORT  0 </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DYLD_INITIALIZER_SUPPORT</span></span><br><span class="line">    <span class="comment">// run all C++ initializers inside dyld</span></span><br><span class="line">    runDyldInitializers(argc, argv, envp, apple);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// now that we are done bootstrapping dyld, call dyld&#x27;s main</span></span><br><span class="line">    <span class="keyword">uintptr_t</span> appsSlide = appsMachHeader-&gt;getSlide();</span><br><span class="line">    <span class="keyword">return</span> dyld::_main((macho_header*)appsMachHeader, appsSlide, argc, argv, envp, apple, startGlue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="dyld-main"><a href="#dyld-main" class="headerlink" title="dyld::_main"></a>dyld::_main</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">intptr_t</span></span><br><span class="line">_main(<span class="keyword">const</span> macho_header* mainExecutableMH, <span class="keyword">uintptr_t</span> mainExecutableSlide,</span><br><span class="line">		<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span>* argv[], <span class="keyword">const</span> <span class="keyword">char</span>* envp[], <span class="keyword">const</span> <span class="keyword">char</span>* apple[], </span><br><span class="line">		<span class="keyword">uintptr_t</span>* startGlue)</span><br><span class="line">&#123;</span><br><span class="line">	......</span><br><span class="line"></span><br><span class="line">	<span class="keyword">uintptr_t</span> result = <span class="number">0</span>;</span><br><span class="line">	sMainExecutableMachHeader = mainExecutableMH;</span><br><span class="line">	sMainExecutableSlide = mainExecutableSlide;</span><br><span class="line"></span><br><span class="line">	......</span><br><span class="line"></span><br><span class="line">	CRSetCrashLogMessage(<span class="string">&quot;dyld: launch started&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// è®¾ç½®ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</span></span><br><span class="line">	setContext(mainExecutableMH, argc, argv, envp, apple);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ£€æŸ¥ç¯å¢ƒå˜é‡</span></span><br><span class="line">	checkEnvironmentVariables(envp);</span><br><span class="line">	defaultUninitializedFallbackPaths(envp);</span><br><span class="line">	<span class="comment">// æ ¹æ®ç¯å¢ƒå˜é‡è¿›è¡Œæ‰“å°è¾“å‡º</span></span><br><span class="line">	<span class="keyword">if</span> ( sEnv.DYLD_PRINT_OPTS )</span><br><span class="line">		printOptions(argv);</span><br><span class="line">	<span class="keyword">if</span> ( sEnv.DYLD_PRINT_ENV ) </span><br><span class="line">		printEnvironmentVariables(envp);</span><br><span class="line"></span><br><span class="line">	......</span><br><span class="line"></span><br><span class="line">	<span class="comment">// åŠ è½½ shared cache</span></span><br><span class="line">	<span class="comment">// load shared cache</span></span><br><span class="line">	checkSharedRegionDisable((dyld3::MachOLoaded*)mainExecutableMH, mainExecutableSlide);</span><br><span class="line">	<span class="keyword">if</span> ( gLinkContext.sharedRegionMode != ImageLoader::kDontUseSharedRegion ) &#123;</span><br><span class="line">		mapSharedCache();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	......</span><br><span class="line"></span><br><span class="line">	<span class="comment">// install gdb notifier</span></span><br><span class="line">	stateToHandlers(dyld_image_state_dependents_mapped, sBatchHandlers)-&gt;push_back(notifyGDB);</span><br><span class="line">	stateToHandlers(dyld_image_state_mapped, sSingleHandlers)-&gt;push_back(updateAllImages);</span><br><span class="line">	<span class="comment">// make initial allocations large enough that it is unlikely to need to be re-alloced</span></span><br><span class="line">	sImageRoots.reserve(<span class="number">16</span>);</span><br><span class="line">	sAddImageCallbacks.reserve(<span class="number">4</span>);</span><br><span class="line">	sRemoveImageCallbacks.reserve(<span class="number">4</span>);</span><br><span class="line">	sAddLoadImageCallbacks.reserve(<span class="number">4</span>);</span><br><span class="line">	sImageFilesNeedingTermination.reserve(<span class="number">16</span>);</span><br><span class="line">	sImageFilesNeedingDOFUnregistration.reserve(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// å°†dyldæœ¬èº«æ·»åŠ åˆ°UUIDåˆ—è¡¨</span></span><br><span class="line">		<span class="comment">// add dyld itself to UUID list</span></span><br><span class="line">		addDyldImageToUUIDList();</span><br><span class="line"></span><br><span class="line">		......</span><br><span class="line"></span><br><span class="line">		<span class="comment">// å®ä¾‹åŒ–ä¸»ç¨‹åº</span></span><br><span class="line">		<span class="comment">// instantiate ImageLoader for main executable</span></span><br><span class="line">		sMainExecutable = instantiateFromLoadedImage(mainExecutableMH, mainExecutableSlide, sExecPath);</span><br><span class="line">		gLinkContext.mainExecutable = sMainExecutable;</span><br><span class="line">		gLinkContext.mainExecutableCodeSigned = hasCodeSignatureLoadCommand(mainExecutableMH);</span><br><span class="line"></span><br><span class="line">		......</span><br><span class="line"></span><br><span class="line">		<span class="comment">// åŠ è½½ inserted libraries</span></span><br><span class="line">		<span class="comment">// load any inserted libraries</span></span><br><span class="line">		<span class="keyword">if</span>	( sEnv.DYLD_INSERT_LIBRARIES != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">char</span>* <span class="keyword">const</span>* lib = sEnv.DYLD_INSERT_LIBRARIES; *lib != <span class="literal">NULL</span>; ++lib) </span><br><span class="line">				loadInsertedDylib(*lib);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// record count of inserted libraries so that a flat search will look at </span></span><br><span class="line">		<span class="comment">// inserted libraries, then main, then others.</span></span><br><span class="line">		sInsertedDylibCount = sAllImages.size()<span class="number">-1</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// é“¾æ¥ä¸»ç¨‹åº</span></span><br><span class="line">		<span class="comment">// link main executable</span></span><br><span class="line">		gLinkContext.linkingMainExecutable = <span class="literal">true</span>;</span><br><span class="line">		link(sMainExecutable, sEnv.DYLD_BIND_AT_LAUNCH, <span class="literal">true</span>, ImageLoader::RPathChain(<span class="literal">NULL</span>, <span class="literal">NULL</span>), <span class="number">-1</span>);</span><br><span class="line">		sMainExecutable-&gt;setNeverUnloadRecursive();</span><br><span class="line">		<span class="keyword">if</span> ( sMainExecutable-&gt;forceFlat() ) &#123;</span><br><span class="line">			gLinkContext.bindFlat = <span class="literal">true</span>;</span><br><span class="line">			gLinkContext.prebindUsage = ImageLoader::kUseNoPrebinding;</span><br><span class="line">		&#125;</span><br><span class="line">    </span><br><span class="line">		<span class="comment">// é“¾æ¥ inserted libraries</span></span><br><span class="line">		<span class="comment">// link any inserted libraries</span></span><br><span class="line">		<span class="comment">// do this after linking main executable so that any dylibs pulled in by inserted </span></span><br><span class="line">		<span class="comment">// dylibs (e.g. libSystem) will not be in front of dylibs the program uses</span></span><br><span class="line">		<span class="keyword">if</span> ( sInsertedDylibCount &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span> i=<span class="number">0</span>; i &lt; sInsertedDylibCount; ++i) &#123;</span><br><span class="line">				ImageLoader* image = sAllImages[i+<span class="number">1</span>];</span><br><span class="line">				link(image, sEnv.DYLD_BIND_AT_LAUNCH, <span class="literal">true</span>, ImageLoader::RPathChain(<span class="literal">NULL</span>, <span class="literal">NULL</span>), <span class="number">-1</span>);</span><br><span class="line">				image-&gt;setNeverUnloadRecursive();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> ( gLinkContext.allowInterposing ) &#123;</span><br><span class="line">				<span class="comment">// only INSERTED libraries can interpose</span></span><br><span class="line">				<span class="comment">// register interposing info after all inserted libraries are bound so chaining works</span></span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span> i=<span class="number">0</span>; i &lt; sInsertedDylibCount; ++i) &#123;</span><br><span class="line">					ImageLoader* image = sAllImages[i+<span class="number">1</span>];</span><br><span class="line">					image-&gt;registerInterposing(gLinkContext);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( gLinkContext.allowInterposing ) &#123;</span><br><span class="line">			<span class="comment">// &lt;rdar://problem/19315404&gt; dyld should support interposition even without DYLD_INSERT_LIBRARIES</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">long</span> i=sInsertedDylibCount+<span class="number">1</span>; i &lt; sAllImages.size(); ++i) &#123;</span><br><span class="line">				ImageLoader* image = sAllImages[i];</span><br><span class="line">				<span class="keyword">if</span> ( image-&gt;inSharedCache() )</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				image-&gt;registerInterposing(gLinkContext);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	</span><br><span class="line">		......</span><br><span class="line"></span><br><span class="line">		<span class="comment">// apply interposing to initial set of images</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; sImageRoots.size(); ++i) &#123;</span><br><span class="line">			sImageRoots[i]-&gt;applyInterposing(gLinkContext);</span><br><span class="line">		&#125;</span><br><span class="line">		ImageLoader::applyInterposingToDyldCache(gLinkContext);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Bind and notify for the main executable now that interposing has been registered</span></span><br><span class="line">		<span class="keyword">uint64_t</span> bindMainExecutableStartTime = mach_absolute_time();</span><br><span class="line">		sMainExecutable-&gt;recursiveBindWithAccounting(gLinkContext, sEnv.DYLD_BIND_AT_LAUNCH, <span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">uint64_t</span> bindMainExecutableEndTime = mach_absolute_time();</span><br><span class="line">		ImageLoaderMachO::fgTotalBindTime += bindMainExecutableEndTime - bindMainExecutableStartTime;</span><br><span class="line">		gLinkContext.notifyBatch(dyld_image_state_bound, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Bind and notify for the inserted images now interposing has been registered</span></span><br><span class="line">		<span class="keyword">if</span> ( sInsertedDylibCount &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">unsigned</span> <span class="keyword">int</span> i=<span class="number">0</span>; i &lt; sInsertedDylibCount; ++i) &#123;</span><br><span class="line">				ImageLoader* image = sAllImages[i+<span class="number">1</span>];</span><br><span class="line">				image-&gt;recursiveBind(gLinkContext, sEnv.DYLD_BIND_AT_LAUNCH, <span class="literal">true</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// &lt;rdar://problem/12186933&gt; do weak binding only after all inserted images linked</span></span><br><span class="line">		sMainExecutable-&gt;weakBind(gLinkContext);</span><br><span class="line">		gLinkContext.linkingMainExecutable = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		sMainExecutable-&gt;recursiveMakeDataReadOnly(gLinkContext);</span><br><span class="line"></span><br><span class="line">		CRSetCrashLogMessage(<span class="string">&quot;dyld: launch, running initializers&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–ç¨‹åº(ğŸ””ğŸ””ğŸ””è¿™ä¸ªæ–¹æ³•ç›¸å½“çš„é‡è¦â—ï¸â—ï¸â—ï¸)</span></span><br><span class="line">		<span class="comment">// run all initializers</span></span><br><span class="line">		initializeMainExecutable();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// é€šçŸ¥ä¸€äº›ç›‘è§†è¿›ç¨‹è¯¥è¿›ç¨‹å°†è¦è¿›å…¥main()</span></span><br><span class="line">		<span class="comment">// notify any montoring proccesses that this process is about to enter main()</span></span><br><span class="line">		notifyMonitoringDyldMain();</span><br><span class="line"></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// æŸ¥æ‰¾ä¸»ç¨‹åºçš„å…¥å£</span></span><br><span class="line">			<span class="comment">// find entry point for main executable</span></span><br><span class="line">			result = (<span class="keyword">uintptr_t</span>)sMainExecutable-&gt;getEntryFromLC_MAIN();</span><br><span class="line">			<span class="keyword">if</span> ( result != <span class="number">0</span> ) &#123;</span><br><span class="line">				<span class="comment">// main executable uses LC_MAIN, we need to use helper in libdyld to call into main()</span></span><br><span class="line">				<span class="keyword">if</span> ( (gLibSystemHelpers != <span class="literal">NULL</span>) &amp;&amp; (gLibSystemHelpers-&gt;version &gt;= <span class="number">9</span>) )</span><br><span class="line">					*startGlue = (<span class="keyword">uintptr_t</span>)gLibSystemHelpers-&gt;startGlueToCallExit;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">					halt(<span class="string">&quot;libdyld.dylib support not present for LC_MAIN&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">// main executable uses LC_UNIXTHREAD, dyld needs to let &quot;start&quot; in program set up for main()</span></span><br><span class="line">				result = (<span class="keyword">uintptr_t</span>)sMainExecutable-&gt;getEntryFromLC_UNIXTHREAD();</span><br><span class="line">				*startGlue = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span>(<span class="keyword">const</span> <span class="keyword">char</span>* message) &#123;</span><br><span class="line">		syncAllImages();</span><br><span class="line">		halt(message);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span>(...) &#123;</span><br><span class="line">		dyld::<span class="built_in">log</span>(<span class="string">&quot;dyld: launch failed\n&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>è®¾ç½®ä¸Šä¸‹æ–‡ç­‰ä¿¡æ¯</li>
<li>æ£€æŸ¥ç¯å¢ƒå˜é‡</li>
<li>åŠ è½½ shared cache</li>
<li>å°†dyldæœ¬èº«æ·»åŠ åˆ°UUIDåˆ—è¡¨</li>
<li>å®ä¾‹åŒ–ä¸»ç¨‹åº</li>
<li>é“¾æ¥ä¸»ç¨‹åº</li>
<li>é“¾æ¥ inserted libraries</li>
<li>è¿è¡Œæ‰€æœ‰åˆå§‹åŒ–ç¨‹åº</li>
<li>é€šçŸ¥ä¸€äº›ç›‘è§†è¿›ç¨‹è¯¥è¿›ç¨‹å°†è¦è¿›å…¥main()</li>
<li>æŸ¥æ‰¾ä¸»ç¨‹åºçš„å…¥å£</li>
</ul>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/ba9af90f/">YYCacheæºç å­¦ä¹ </a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-10-19
        </span></div>
    </header>

    <div class="post-content"><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">YYCache</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">copy</span>, <span class="keyword">readonly</span>) <span class="built_in">NSString</span> *name;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">readonly</span>) YYMemoryCache *memoryCache;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">readonly</span>) YYDiskCache *diskCache;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithName:(<span class="built_in">NSString</span> *)name;</span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)initWithPath:(<span class="built_in">NSString</span> *)path <span class="built_in">NS_DESIGNATED_INITIALIZER</span>;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)cacheWithName:(<span class="built_in">NSString</span> *)name;</span><br><span class="line">+ (<span class="keyword">nullable</span> <span class="keyword">instancetype</span>)cacheWithPath:(<span class="built_in">NSString</span> *)path;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)init UNAVAILABLE_ATTRIBUTE;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)new UNAVAILABLE_ATTRIBUTE;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - Access Methods</span></span><br><span class="line"><span class="comment">// æ˜¯å¦åŒ…å«æŸä¸ªç¼“å­˜å¯¹è±¡</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)containsObjectForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="keyword">void</span>)containsObjectForKey:(<span class="built_in">NSString</span> *)key withBlock:(<span class="keyword">nullable</span> <span class="keyword">void</span>(^)(<span class="built_in">NSString</span> *key, <span class="built_in">BOOL</span> contains))block;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ç¼“å­˜å¯¹è±¡</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>&lt;<span class="built_in">NSCoding</span>&gt;)objectForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="keyword">void</span>)objectForKey:(<span class="built_in">NSString</span> *)key withBlock:(<span class="keyword">nullable</span> <span class="keyword">void</span>(^)(<span class="built_in">NSString</span> *key, <span class="keyword">id</span>&lt;<span class="built_in">NSCoding</span>&gt; object))block;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¿å­˜ç¼“å­˜å¯¹è±¡</span></span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">nullable</span> <span class="keyword">id</span>&lt;<span class="built_in">NSCoding</span>&gt;)object forKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">nullable</span> <span class="keyword">id</span>&lt;<span class="built_in">NSCoding</span>&gt;)object forKey:(<span class="built_in">NSString</span> *)key withBlock:(<span class="keyword">nullable</span> <span class="keyword">void</span>(^)(<span class="keyword">void</span>))block;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æŸä¸ªç¼“å­˜å¯¹è±¡</span></span><br><span class="line">- (<span class="keyword">void</span>)removeObjectForKey:(<span class="built_in">NSString</span> *)key;</span><br><span class="line">- (<span class="keyword">void</span>)removeObjectForKey:(<span class="built_in">NSString</span> *)key withBlock:(<span class="keyword">nullable</span> <span class="keyword">void</span>(^)(<span class="built_in">NSString</span> *key))block;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ é™¤æ‰€æœ‰ç¼“å­˜å¯¹è±¡</span></span><br><span class="line">- (<span class="keyword">void</span>)removeAllObjects;</span><br><span class="line">- (<span class="keyword">void</span>)removeAllObjectsWithBlock:(<span class="keyword">void</span>(^)(<span class="keyword">void</span>))block;</span><br><span class="line">- (<span class="keyword">void</span>)removeAllObjectsWithProgressBlock:(<span class="keyword">nullable</span> <span class="keyword">void</span>(^)(<span class="keyword">int</span> removedCount, <span class="keyword">int</span> totalCount))progress</span><br><span class="line">                                 endBlock:(<span class="keyword">nullable</span> <span class="keyword">void</span>(^)(<span class="built_in">BOOL</span> error))end;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/d115d42e/">iOS Blockåº•å±‚åŸç†</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-08-29
        </span></div>
    </header>

    <div class="post-content"><h2 id="Blockçš„åº•å±‚ç»“æ„"><a href="#Blockçš„åº•å±‚ç»“æ„" class="headerlink" title="Blockçš„åº•å±‚ç»“æ„"></a>Blockçš„åº•å±‚ç»“æ„</h2><ul>
<li>æœ€æ™®é€šçš„Block</li>
<li>å¸¦<code>å‚æ•°</code>çš„Block</li>
<li>è®¿é—®äº†å¤–éƒ¨<code>autoå˜é‡</code>çš„Block</li>
<li>è®¿é—®äº†å¤–éƒ¨<code>staticå˜é‡</code>çš„Block</li>
<li>è®¿é—®äº†<code>å…¨å±€å˜é‡</code>çš„Block</li>
</ul>
          <div class="read-more">
            <a href="/posts/d115d42e/" class="read-more-link">Read more..</a>
          </div>
        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/7f2a4d1e/">iOS è‡ªåŠ¨é‡Šæ”¾æ± (autoreleasepool)</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-08-26
        </span><span class="post-category">
            <a href="/categories/iOS/">iOS</a>
            </span>
        </div>
    </header>

    <div class="post-content"><h2 id="AutoreleasePoolç®€ä»‹"><a href="#AutoreleasePoolç®€ä»‹" class="headerlink" title="AutoreleasePoolç®€ä»‹"></a>AutoreleasePoolç®€ä»‹</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/foundation/nsautoreleasepool">Appleå®˜æ–¹è¯´æ˜</a>ï¼šä¸€ä¸ªç”¨æ¥æ”¯æŒå¼•ç”¨è®¡æ•°å†…å­˜ç®¡ç†ç³»ç»Ÿçš„å¯¹è±¡ï¼›</li>
</ul>
          <div class="read-more">
            <a href="/posts/7f2a4d1e/" class="read-more-link">Read more..</a>
          </div>
        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/638a6f77/">iOS åˆ†ç±»(Categoty)</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-08-25
        </span><span class="post-category">
            <a href="/categories/iOS/">iOS</a>
            </span>
        </div>
    </header>

    <div class="post-content"><h2 id="Categoty-åº•å±‚ç»“æ„"><a href="#Categoty-åº•å±‚ç»“æ„" class="headerlink" title="Categoty åº•å±‚ç»“æ„"></a>Categoty åº•å±‚ç»“æ„</h2><p>åœ¨<code>objc-runtime-new.h</code>ä¸­æœ‰å®šä¹‰</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> category_t &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *name;</span><br><span class="line">    classref_t cls;</span><br><span class="line">    <span class="keyword">struct</span> method_list_t *instanceMethods;</span><br><span class="line">    <span class="keyword">struct</span> method_list_t *classMethods;</span><br><span class="line">    <span class="keyword">struct</span> protocol_list_t *protocols;</span><br><span class="line">    <span class="keyword">struct</span> property_list_t *instanceProperties;</span><br><span class="line">    <span class="comment">// Fields below this point are not always present on disk.</span></span><br><span class="line">    <span class="keyword">struct</span> property_list_t *_classProperties;</span><br><span class="line"></span><br><span class="line">    method_list_t *methodsForMeta(<span class="keyword">bool</span> isMeta) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isMeta) <span class="keyword">return</span> classMethods;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> instanceMethods;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    property_list_t *propertiesForMeta(<span class="keyword">bool</span> isMeta, <span class="keyword">struct</span> header_info *hi);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/posts/638a6f77/" class="read-more-link">Read more..</a>
          </div>
        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/97624e89/">nuxtæŒ‰éœ€å¼•å…¥element-UIåŠè‡ªå®šä¹‰ä¸»é¢˜</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-08-16
        </span><span class="post-category">
            <a href="/categories/nuxt/">nuxt</a>
            <a href="/categories/nuxt/vue/">vue</a>
            </span>
        </div>
    </header>

    <div class="post-content"><p>nuxtæŒ‰éœ€å¼•å…¥element-UIåŠè‡ªå®šä¹‰ä¸»é¢˜</p>
          <div class="read-more">
            <a href="/posts/97624e89/" class="read-more-link">Read more..</a>
          </div>
        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/a1b1e2bc/">selfå’Œsuperå…³é”®å­—</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-02-25
        </span></div>
    </header>

    <div class="post-content"><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;self:%@&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]));</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;super:%@&quot;</span>, <span class="built_in">NSStringFromClass</span>([<span class="keyword">super</span> <span class="keyword">class</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* æ‰“å°ç»“æœï¼š</span></span><br><span class="line"><span class="comment">self:ViewController</span></span><br><span class="line"><span class="comment">super:ViewController</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>åˆ†æ</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc ViewController.m -o ViewController.cpp</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¸å¿ƒä»£ç å¦‚ä¸‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSStringFromClass([self class])</span></span><br><span class="line"><span class="built_in">NSStringFromClass</span>(</span><br><span class="line">  objc_msgSend(</span><br><span class="line">    (<span class="keyword">id</span>)<span class="keyword">self</span>, </span><br><span class="line">    sel_registerName(<span class="string">&quot;class&quot;</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSStringFromClass([super class])</span></span><br><span class="line"><span class="built_in">NSStringFromClass</span>(</span><br><span class="line">  objc_msgSendSuper(</span><br><span class="line">    &#123;</span><br><span class="line">      (<span class="keyword">id</span>)<span class="keyword">self</span>, </span><br><span class="line">      (<span class="keyword">id</span>)class_getSuperclass(objc_getClass(<span class="string">&quot;ViewController&quot;</span>))</span><br><span class="line">    &#125;, </span><br><span class="line">    sel_registerName(<span class="string">&quot;class&quot;</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸€ä¸‹<code>objc_msgSend</code>çš„å®šä¹‰ï¼š</p>
<h2 id="objc-msgSend"><a href="#objc-msgSend" class="headerlink" title="objc_msgSend"></a><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/objectivec/1456712-objc_msgsend">objc_msgSend</a></h2><ul>
<li>Sends a message with a simple return value to an instance of a class.</li>
<li>Declaration<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> objc_msgSend(<span class="keyword">void</span>);</span><br></pre></td></tr></table></figure></li>
<li>Parameters<ul>
<li>self<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A pointer that points to the instance of the class that is to receive the message.</span><br><span class="line">è¯‘ï¼šæŒ‡å‘è¦æ¥æ”¶æ¶ˆæ¯çš„ç±»çš„å®ä¾‹çš„æŒ‡é’ˆã€‚</span><br></pre></td></tr></table></figure></li>
<li>op<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The selector of the method that handles the message.</span><br><span class="line">è¯‘ï¼šå¤„ç†æ¶ˆæ¯çš„æ–¹æ³•çš„é€‰æ‹©å™¨ã€‚</span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ul>
<ul>
<li>â€¦<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A variable argument list containing the arguments to the method.</span><br><span class="line">è¯‘ï¼šåŒ…å«è¯¥æ–¹æ³•å‚æ•°çš„å¯å˜å‚æ•°åˆ—è¡¨ã€‚</span><br></pre></td></tr></table></figure>

</li>
</ul>
<ul>
<li>Return Value<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The return value of the method.</span><br><span class="line">è¯‘ï¼šæ–¹æ³•çš„è¿”å›å€¼ã€‚</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h2 id="objc-msgSendSuper"><a href="#objc-msgSendSuper" class="headerlink" title="objc_msgSendSuper"></a><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/objectivec/1456716-objc_msgsendsuper">objc_msgSendSuper</a></h2><ul>
<li>Sends a message with a simple return value to the superclass of an instance of a class.</li>
<li>Declaration<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> objc_msgSendSuper(<span class="keyword">void</span>);</span><br></pre></td></tr></table></figure></li>
<li>Parameters<ul>
<li>self<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A pointer to an objc_super data structure. Pass values identifying the context the message was sent to, including the instance of the class that is to receive the message and the superclass at which to start searching for the method implementation.</span><br><span class="line">è¯‘ï¼šæŒ‡å‘ç»“æ„ä½“objc_superçš„æŒ‡é’ˆã€‚ä¼ é€’ç”¨äºæ ‡è¯†æ¶ˆæ¯å‘é€åˆ°çš„ä¸Šä¸‹æ–‡çš„å€¼ï¼ŒåŒ…æ‹¬å°†æ¥æ”¶æ¶ˆæ¯çš„ç±»çš„å®ä¾‹ä»¥åŠä»å…¶å¼€å§‹æœç´¢æ–¹æ³•å®ç°çš„çˆ¶ç±»ã€‚</span><br></pre></td></tr></table></figure></li>
<li>op<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A pointer of type SEL. Pass the selector of the method that will handle the message.</span><br><span class="line">è¯‘ï¼šç±»å‹çš„æŒ‡é’ˆSELã€‚ä¼ é€’å°†å¤„ç†æ¶ˆæ¯çš„æ–¹æ³•çš„é€‰æ‹©å™¨ã€‚</span><br></pre></td></tr></table></figure>


</li>
</ul>
</li>
</ul>
<ul>
<li>â€¦<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">A variable argument list containing the arguments to the method.</span><br><span class="line">è¯‘ï¼šåŒ…å«è¯¥æ–¹æ³•å‚æ•°çš„å¯å˜å‚æ•°åˆ—è¡¨ã€‚</span><br></pre></td></tr></table></figure>

</li>
</ul>
<ul>
<li>Return Value<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">The return value of the method identified by op.</span><br><span class="line">è¯‘ï¼šç”±æ ‡è¯†çš„æ–¹æ³•çš„è¿”å›å€¼opã€‚</span><br></pre></td></tr></table></figure>


</li>
</ul>
<p>æ‰€ä»¥æ ¸å¿ƒä»£ç ä¹Ÿå°±æ˜¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¸å¿ƒä»£ç å¦‚ä¸‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NSStringFromClass([self class])</span></span><br><span class="line"><span class="built_in">NSStringFromClass</span>(</span><br><span class="line">  objc_msgSend(</span><br><span class="line">    (<span class="keyword">id</span>)<span class="keyword">self</span>, <span class="comment">// æŒ‡å‘è¦æ¥æ”¶æ¶ˆæ¯çš„ç±»çš„å®ä¾‹çš„æŒ‡é’ˆ</span></span><br><span class="line">    sel_registerName(<span class="string">&quot;class&quot;</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSStringFromClass([super class])</span></span><br><span class="line"><span class="built_in">NSStringFromClass</span>(</span><br><span class="line">  objc_msgSendSuper(</span><br><span class="line">    &#123;</span><br><span class="line">      (<span class="keyword">id</span>)<span class="keyword">self</span>, <span class="comment">// æŒ‡å‘è¦æ¥æ”¶æ¶ˆæ¯çš„ç±»çš„å®ä¾‹çš„æŒ‡é’ˆ</span></span><br><span class="line">      (<span class="keyword">id</span>)class_getSuperclass(objc_getClass(<span class="string">&quot;ViewController&quot;</span>))</span><br><span class="line">    &#125;, </span><br><span class="line">    sel_registerName(<span class="string">&quot;class&quot;</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ç”±äºæŒ‡å‘è¦æ¥æ”¶æ¶ˆæ¯çš„ç±»çš„å®ä¾‹çš„æŒ‡é’ˆéƒ½æ˜¯<code>self</code>,æ‰€ä»¥æ‰“å°éƒ½æ˜¯<code>ViewController</code></p>
<p>åŒºåˆ«ï¼š</p>
<p><code>[self class]</code> ä»å½“å‰ç±»å¼€å§‹æ‰¾<code>class</code>æ–¹æ³•</p>
<p><code>[super class]</code> ä»å½“å‰ç´¯çš„çˆ¶ç±»å¼€å§‹æ‰¾<code>class</code>æ–¹æ³•</p>

        </div></article>
      <article class="post">
    <header class="post-header">
      <h1 class="post-title"><a class="post-link" href="/posts/7e500fcd/">iOSè®¾ç½®å•ä¸ªåœ†è§’(cornerRadius)å’Œå•è¾¹é˜´å½±(shaodwRadius)</a>
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2019-01-30
        </span></div>
    </header>

    <div class="post-content"><ul>
<li><p>å¹³æ—¶å¼€å‘æ—¶æ€»ä¼šæœ‰ä¸€äº›ç‰¹æ®Šçš„UIæ•ˆæœä¼šæ¯”è¾ƒçƒ¦äººï¼Œæ¯”å¦‚å•ä¸ªè¾¹çš„åœ†è§’ï¼Œå•ä¸ªè¾¹çš„é˜´å½±ç­‰ç­‰ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨ä¸€ç§å¾ˆeasyçš„æ–¹å¼æ¥å®Œæˆ</p>
</li>
<li><p>æ•ˆæœå¦‚å›¾ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/590107-976fffd316e98cb3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="example"></p>
</li>
<li><p>ä½¿ç”¨æ–¹å¼ï¼š</p>
</li>
<li><p>Installation with CocoaPodsï¼š</p>
<ul>
<li><code>pod &#39;YCShadowView&#39;</code></li>
<li><code>#import &lt;YCShadowView/YCShadowView.h&gt;</code> </li>
</ul>
</li>
<li><p>Manual importï¼š</p>
<ul>
<li>Drag the YCShadowView folder to project</li>
<li><code>#import &quot;YCShadowView.h&quot;</code></li>
</ul>
</li>
<li><p>Use</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">YCShadowView *view = [[YCShadowView alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">200</span>, <span class="number">250</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">[view yc_shaodwRadius:<span class="number">10</span> shadowColor:[<span class="built_in">UIColor</span> colorWithWhite:<span class="number">0</span> alpha:<span class="number">0.5</span>] shadowOffset:<span class="built_in">CGSizeMake</span>(<span class="number">0</span>, <span class="number">0</span>) byShadowSide:(YCShadowSideRight)];</span><br><span class="line">[view yc_cornerRadius:<span class="number">10</span> byRoundingCorners:(<span class="built_in">UIRectCornerBottomLeft</span>)];</span><br></pre></td></tr></table></figure></li>
<li><p>å¦‚æœ‰æ›´å¥½çš„æ–¹å¼æ¥å®ç°æˆ–ä¸å½“ä¹‹å¤„ï¼Œç•™è¨€è®¨è®ºï¼Œæ„Ÿè°¢~</p>
</li>
<li><p>æºç è§ï¼š<a target="_blank" rel="noopener" href="https://github.com/YotrolZ/YCShadowView">github</a></p>
</li>
</ul>

        </div></article>
      <nav class="pagination"><a class="next" href="/page/2/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></section></div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"></div><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">&copy;2015 - 2021<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">YotrolZ</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
