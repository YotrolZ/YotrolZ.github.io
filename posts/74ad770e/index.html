<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="theme-color" content="#f8f5ec"><meta name="msapplication-navbutton-color" content="#f8f5ec"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec"><meta name="description" content="最近在开发过程中发现，git pull/push 总是失败，一直以为是本地SSH相关key的问题，折腾一番始终不好使，最后才发现是Gitlab后台服务器的问题 顺便整理了一下关于SSH的东西"><link rel="alternate" href="/atom.xml" title="YotrolZ" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0"><link rel="canonical" href="http://yotrolz.com/posts/74ad770e/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/css/style.css?v=2.11.0"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-138610487-3"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-138610487-3")</script><script id="baidu_push">!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.10.0/dist/av-min.js"></script><script id="leancloud">AV.init({appId:"mqfPQEKBtui9puAJUkYFY7Jn-MdYXbMMI",appKey:"A6R0T4bEvcBsTU8pB7NhJ6Wl"})</script><script>window.config={leancloud:{show_visits:!1,app_id:"mqfPQEKBtui9puAJUkYFY7Jn-MdYXbMMI",app_key:"A6R0T4bEvcBsTU8pB7NhJ6Wl"},toc:!0,fancybox:!0,pjax:"",latex:!1}</script><title>SSH原理及应用 - YotrolZ</title><meta name="generator" content="Hexo 5.4.1"></head><body><div id="mobile-navbar" class="mobile-navbar"><div class="mobile-header-logo"> <a href="/." class="logo">YotrolZ</a></div><div class="mobile-navbar-icon"><span></span><span></span><span></span></div></div><nav id="mobile-menu" class="mobile-menu slideout-menu"><ul class="mobile-menu-list"><a href="/"><li class="mobile-menu-item">Home</li></a><a href="/archives/"><li class="mobile-menu-item">Archives</li></a><a href="/tags/"><li class="mobile-menu-item">Tags</li></a><a href="/categories/"><li class="mobile-menu-item">Categories</li></a></ul></nav><div class="container" id="mobile-panel"><header id="header" class="header"><div class="logo-wrapper"> <a href="/." class="logo">YotrolZ</a></div><nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item"> <a class="menu-item-link" href="/">Home</a></li><li class="menu-item"> <a class="menu-item-link" href="/archives/">Archives</a></li><li class="menu-item"> <a class="menu-item-link" href="/tags/">Tags</a></li><li class="menu-item"> <a class="menu-item-link" href="/categories/">Categories</a></li></ul></nav></header><main id="main" class="main"><div class="content-wrapper"><div id="content" class="content"><article class="post"><header class="post-header"><h1 class="post-title">SSH原理及应用</h1><div class="post-meta"> <span class="post-time">2021-03-16</span> <span class="post-visits" style="display:none" data-url="/posts/74ad770e/" data-title="SSH原理及应用">Visits 0</span></div></header><div class="post-toc" id="post-toc"><h2 class="post-toc-title">Contents</h2><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SSH-%E7%AE%80%E4%BB%8B"><span class="toc-text">SSH 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E6%96%B9%E5%BC%8F"><span class="toc-text">加密方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-text">对称加密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E6%B5%81%E7%A8%8B"><span class="toc-text">加密流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%98%E9%92%A5%E5%A4%A7%E5%B0%8F"><span class="toc-text">秘钥大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95"><span class="toc-text">对称加密算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-text">非对称加密</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E6%B5%81%E7%A8%8B%EF%BC%9A"><span class="toc-text">加密流程：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%EF%BC%9A"><span class="toc-text">加密算法：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSH-%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">SSH 应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%8F%A3%E4%BB%A4%E7%9A%84%E8%AE%A4%E8%AF%81"><span class="toc-text">基于口令的认证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E6%AC%A1%E7%99%BB%E5%BD%95"><span class="toc-text">首次登录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#known-hosts-%E6%96%87%E4%BB%B6"><span class="toc-text">known_hosts 文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%85%AC%E9%92%A5%E8%AE%A4%E8%AF%81"><span class="toc-text">基于公钥认证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#authorized-keys-%E6%96%87%E4%BB%B6"><span class="toc-text">authorized_keys 文件</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h1 id="SSH-简介"><a href="#SSH-简介" class="headerlink" title="SSH 简介"></a>SSH 简介</h1><p><code>SSH(Secure Shell)</code>: 安全外壳协议,是一种<code>加密</code>的<code>网络传输协议</code>，可在不安全的网络中为网络服务提供安全的传输环境;</p><ul><li><code>SSH</code>最常见的用途是<code>远程登录</code>系统;</li><li><code>SSH</code>使用<code>客户端-服务器(C-S)</code>模型，标准端口为<code>22</code>;</li><li><code>SSH</code>以<code>非对称加密</code>实现<code>身份验证</code>;</li><li>截至2005年，<code>OpenSSH</code>是唯一一种最流行的SSH实现，而且成为了大量操作系统的默认组件;</li></ul><span id="more"></span><h1 id="加密方式"><a href="#加密方式" class="headerlink" title="加密方式"></a>加密方式</h1><p><code>SSH</code>以<code>非对称加密</code>实现<code>身份验证</code>的，我们来简单介绍一下，<code>对称加密</code> 和 <code>非对称加密</code></p><h2 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h2><h3 id="加密流程"><a href="#加密流程" class="headerlink" title="加密流程"></a>加密流程</h3><ul><li>对称加密：<code>加密</code> 和 <code>解密</code> 使用同一个 <code>秘钥</code>;</li><li>加密流程：<ul><li>客户端使用 <code>秘钥A</code> 对数据进行加密后发送给服务端；</li><li>服务端收到数据后，同样使用 <code>秘钥A</code> 进行解密；</li></ul></li></ul><h3 id="秘钥大小"><a href="#秘钥大小" class="headerlink" title="秘钥大小"></a>秘钥大小</h3><ul><li>密钥的大小既要照顾到<code>安全性</code>，也要照顾到<code>效率</code>; <code>对称加密</code>通常使用的是相对较小的密钥，一般小于<code>256bit</code>。因为密钥越大，加密越强，但加密与解密的过程越慢;</li></ul><h3 id="对称加密算法"><a href="#对称加密算法" class="headerlink" title="对称加密算法"></a>对称加密算法</h3><ul><li>常见的对称加密算法：<code>DES</code>，<code>AES</code>等。</li></ul><h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><ul><li>优点：效率高；</li><li>缺点：<code>密钥</code>的<code>管理与分配</code>；</li></ul><p>note：如何把密钥发送到需要解密你的消息的人的手里是一个问题。在发送密钥的过程中，密钥有很大的风险会被黑客们拦截。现实中通常的做法是将对称加密的密钥进行非对称加密，然后传送给需要它的人。</p><h2 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h2><h3 id="加密流程："><a href="#加密流程：" class="headerlink" title="加密流程："></a>加密流程：</h3><ul><li>非对称加密 有两个秘钥：<code>公钥</code> 和 <code>私钥</code>；</li><li>加密流程：<ul><li>使用 <code>公钥</code> 对数据进行加密；</li><li>只能使用<code>相对应</code>的 <code>私钥</code> 才能解密；</li></ul></li></ul><h3 id="加密算法："><a href="#加密算法：" class="headerlink" title="加密算法："></a>加密算法：</h3><ul><li>常见的非对称加密有 <code>RSA</code>;</li></ul><h1 id="SSH-应用场景"><a href="#SSH-应用场景" class="headerlink" title="SSH 应用场景"></a>SSH 应用场景</h1><h2 id="基于口令的认证"><a href="#基于口令的认证" class="headerlink" title="基于口令的认证"></a>基于口令的认证</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">命令格式：ssh 客户端用户名@服务器ip地址</span></span><br><span class="line">ssh admin@192.168.0.1</span><br></pre></td></tr></table></figure><ul><li><p>如果客户端的用户名和服务端的用户名相同，登录时可以省略用户名。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh 192.168.0.1</span><br></pre></td></tr></table></figure></li><li><p>SSH服务的默认端口是22，也可以通过 -p 来指定端口号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 1234 admin@192.168.0.1</span><br></pre></td></tr></table></figure></li></ul><h3 id="首次登录"><a href="#首次登录" class="headerlink" title="首次登录"></a>首次登录</h3><p>当我们<code>第一次</code>登录对方主机，系统会出现如下的提示信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$ </span><span class="language-bash">ssh user@host</span></span><br><span class="line">The authenticity of host &#x27;host (12.18.429.21)&#x27; can&#x27;t be established.</span><br><span class="line">RSA key fingerprint is 98:2e:d7:e0:de:9f:ac:67:28:c2:42:2d:37:16:58:4d.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)?</span><br></pre></td></tr></table></figure><p>意思就是：无法确认远程host主机的真实性，只知道它的公钥指纹，是否继续连接？</p><ul><li><strong>公钥指纹</strong>：由于公钥长度较长(这里采用RSA算法，长达1024位),难以比较，可以对其进行<code>MD5</code>等运算后进行比较；</li></ul><p>输入<code>yes</code>: 会提示远程主机被添加到已知主机列表</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Warning: Permanently added &#x27;host,12.18.429.21&#x27; (RSA) to the list of known hosts.</span><br></pre></td></tr></table></figure><p>然后会要求我们输入远程主机的<code>密码</code>，输入的密码正确就可以成功登录了;</p><h3 id="known-hosts-文件"><a href="#known-hosts-文件" class="headerlink" title="known_hosts 文件"></a>known_hosts 文件</h3><ul><li>客户端通过SSH首次连接到服务端后，服务端会将一个<code>公钥</code>(公钥1)传递给客户端；</li><li>客户端收到这个<code>公钥</code>(公钥1)后将其存入<code>known_hosts</code>中；</li><li>之后再次连接服务端时，服务端依然会返回一个<code>公钥</code>(公钥2)；</li><li>通过对比<code>公钥1</code>和<code>公钥2</code> <code>是否相同</code>来进行<code>验证</code>，如果不同就会发出警告<code>Host key verification failed</code>，并登陆失败；</li></ul><p>在<code>macOS</code>系统的中，<code>known_hosts</code> 文件位于<code>/Users/用户名/.ssh/known_hosts</code></p><h2 id="基于公钥认证"><a href="#基于公钥认证" class="headerlink" title="基于公钥认证"></a>基于公钥认证</h2><p>在上面的基于口令的认证方式中，我们每次都必须输入密码，非常麻烦，SSH还提供了基于公钥登录的方式，可以省去输入密码的步骤；具体步骤如下：</p><ul><li>客户端生成一对秘钥(公钥&amp;私钥)</li><li>将上述的公钥储存在服务端上(存放在服务端的<code>authorized_keys</code>文件中)</li><li>客户端发起登陆请求，服务端收到后会生成一个随机的字符串，然后使用事先存储的公钥进行加密，然后将加密后的字符串发送给客户端</li><li>客户端收到这个加密的字符串后，使用私钥进行解密，然后将解密后的数据再发送回服务端</li><li>服务端收到客户端发送的解密数据后，进行校验，如果为同一个字符串，登陆成功；否则，登陆失败</li></ul><p><em>note:上述仅仅是<code>SSH公钥认证</code>的大体流程。想要了解更详细的内容可以搜索 <code>SSH sessionKey</code>;</em></p><h3 id="authorized-keys-文件"><a href="#authorized-keys-文件" class="headerlink" title="authorized_keys 文件"></a>authorized_keys 文件</h3><ul><li>将客户端公钥存储到服务端上，其实就是将客户端的公钥数据放到了服务端的<code>authorized_keys</code>文件中；</li><li>在<code>Linux</code>系统中，<code>authorized_keys</code> 文件位于 <code>~/.ssh/authorized_keys</code></li></ul><blockquote><p>是不是想起我们在Github 设置中配置 SSH key 的场景了~</p></blockquote></div><div class="post-copyright"><p class="copyright-item"> <span>Author:</span> <a href="http://yotrolz.com">YotrolZ</a></p><p class="copyright-item"> <span>Link:</span> <a href="http://yotrolz.com/posts/74ad770e/">http://yotrolz.com/posts/74ad770e/</a></p><p class="copyright-item"> <span>License:</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a></p></div><footer class="post-footer"><nav class="post-nav"><a class="prev" href="/posts/7da1630e/"><i class="iconfont icon-left"></i> <span class="prev-text nav-default">HTTP压测工具之wrk</span> <span class="prev-text nav-mobile">Prev</span></a> <a class="next" href="/posts/993b4752/"><span class="next-text nav-default">再说iOS中的Class</span> <span class="prev-text nav-mobile">Next</span><i class="iconfont icon-right"></i></a></nav></footer></article></div><div class="comments" id="comments"></div></div></main><footer id="footer" class="footer"><div class="social-links"></div><div class="copyright"> <span class="power-by">Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span> <span class="division">|</span> <span class="theme-info">Theme - <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a></span> <span class="copyright-year">&copy;2015 - 2022<span class="heart"><i class="iconfont icon-heart"></i></span> <span class="author">YotrolZ</span></span></div></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/lib/jquery/jquery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/lib/slideout/slideout.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/lib/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/js/src/even.js?v=2.11.0"></script></body></html>