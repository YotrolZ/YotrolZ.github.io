<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="theme-color" content="#f8f5ec"><meta name="msapplication-navbutton-color" content="#f8f5ec"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec"><meta name="description" content="iOS中传感器的基本使用"><link rel="alternate" href="/atom.xml" title="YotrolZ" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0"><link rel="canonical" href="http://yotrolz.com/posts/1ea19737/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/css/style.css?v=2.11.0"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-138610487-3"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-138610487-3")</script><script id="baidu_push">!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="//cdn.jsdelivr.net/npm/leancloud-storage@4.10.0/dist/av-min.js"></script><script id="leancloud">AV.init({appId:"mqfPQEKBtui9puAJUkYFY7Jn-MdYXbMMI",appKey:"A6R0T4bEvcBsTU8pB7NhJ6Wl"})</script><script>window.config={leancloud:{show_visits:!1,app_id:"mqfPQEKBtui9puAJUkYFY7Jn-MdYXbMMI",app_key:"A6R0T4bEvcBsTU8pB7NhJ6Wl"},toc:!0,fancybox:!0,pjax:"",latex:!1}</script><title>iOS中传感器的基本使用 - YotrolZ</title><meta name="generator" content="Hexo 5.4.1"></head><body><div id="mobile-navbar" class="mobile-navbar"><div class="mobile-header-logo"> <a href="/." class="logo">YotrolZ</a></div><div class="mobile-navbar-icon"><span></span><span></span><span></span></div></div><nav id="mobile-menu" class="mobile-menu slideout-menu"><ul class="mobile-menu-list"><a href="/"><li class="mobile-menu-item">Home</li></a><a href="/archives/"><li class="mobile-menu-item">Archives</li></a><a href="/tags/"><li class="mobile-menu-item">Tags</li></a><a href="/categories/"><li class="mobile-menu-item">Categories</li></a></ul></nav><div class="container" id="mobile-panel"><header id="header" class="header"><div class="logo-wrapper"> <a href="/." class="logo">YotrolZ</a></div><nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item"> <a class="menu-item-link" href="/">Home</a></li><li class="menu-item"> <a class="menu-item-link" href="/archives/">Archives</a></li><li class="menu-item"> <a class="menu-item-link" href="/tags/">Tags</a></li><li class="menu-item"> <a class="menu-item-link" href="/categories/">Categories</a></li></ul></nav></header><main id="main" class="main"><div class="content-wrapper"><div id="content" class="content"><article class="post"><header class="post-header"><h1 class="post-title">iOS中传感器的基本使用</h1><div class="post-meta"> <span class="post-time">2015-08-21</span> <span class="post-category"><a href="/categories/iOS/">iOS</a></span> <span class="post-visits" style="display:none" data-url="/posts/1ea19737/" data-title="iOS中传感器的基本使用">Visits 0</span></div></header><div class="post-toc" id="post-toc"><h2 class="post-toc-title">Contents</h2><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#iOS%E4%B8%AD%E5%B8%B8%E8%A7%81%E7%9A%84%E4%BC%A0%E6%84%9F%E5%99%A8"><span class="toc-text">iOS中常见的传感器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E8%B7%9D%E7%A6%BB%E4%BC%A0%E6%84%9F%E5%99%A8"><span class="toc-text">一.距离传感器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E5%8A%A0%E9%80%9F%E8%AE%A1-UIAccelerometer"><span class="toc-text">二.加速计(UIAccelerometer)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-Core-Motion"><span class="toc-text">三 . Core Motion</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Core-Motion%E7%9A%84%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%E2%80%94push"><span class="toc-text">Core Motion的使用步骤—push</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Core-Motion%E7%9A%84%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%E2%80%94pull"><span class="toc-text">Core Motion的使用步骤—pull</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B-%E7%A3%81%E5%8A%9B%E8%AE%A1-%E9%99%80%E8%9E%BA%E4%BB%AA%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E4%B8%8A%E8%BF%B0%E5%8A%A0%E9%80%9F%E8%AE%A1%E7%9A%84%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%E7%B1%BB%E4%BC%BC"><span class="toc-text">四.磁力计&#x2F;陀螺仪的使用和上述加速计的使用步骤类似</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%94-%E6%B2%A1%E4%BA%8B%E4%BD%A0%E5%B0%B1-%E6%91%87%E4%B8%80%E6%91%87"><span class="toc-text">五.没事你就,摇一摇</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%AD-%E6%B2%A1%E4%BA%8B%E8%B5%B0%E4%B8%A4%E6%AD%A5-%E8%AE%A1%E6%AD%A5%E5%99%A8"><span class="toc-text">六. 没事走两步(计步器)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%83-%E8%93%9D%E7%89%99"><span class="toc-text">七.蓝牙</span></a></li></ol></div></div><div class="post-content"><h2 id="iOS中常见的传感器"><a href="#iOS中常见的传感器" class="headerlink" title="iOS中常见的传感器"></a>iOS中常见的传感器</h2><p><img src="http://upload-images.jianshu.io/upload_images/590107-b80b8936f8277f84.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="iOS中常见的传感器"></p><span id="more"></span><h3 id="一-距离传感器"><a href="#一-距离传感器" class="headerlink" title="一.距离传感器"></a>一.距离传感器</h3><ul><li><p>监听方式:添加<code>观察者</code>,监听<code>通知</code></p></li><li><p>通知名称:<code>UIDeviceProximityStateDidChangeNotification</code></p></li><li><p>监听状态:观察者的对应回调方法中,判断<code>[UIDevice currentDevice].proximityState</code></p><ul><li>返回 <code>NO</code> : 有物品靠近了;</li><li>返回 <code>YES</code> : 有物品远离了</li></ul></li><li><p>注意:使用前要打开当前设备距离传感器的开关(默认为:NO):</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">UIDevice</span> currentDevice].proximityMonitoringEnabled = <span class="literal">YES</span>;</span><br></pre></td></tr></table></figure></li><li><p>示例程序:</p></li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// [UIApplication sharedApplication].proximitySensingEnabled = YES;</span></span><br><span class="line">    [<span class="built_in">UIDevice</span> currentDevice].proximityMonitoringEnabled = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 监听有物品靠近还是离开</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(proximityStateDidChange) name:<span class="built_in">UIDeviceProximityStateDidChangeNotification</span> object:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)proximityStateDidChange</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">UIDevice</span> currentDevice].proximityState) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;有物品靠近&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;有物品离开&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="二-加速计-UIAccelerometer"><a href="#二-加速计-UIAccelerometer" class="headerlink" title="二.加速计(UIAccelerometer)"></a>二.加速计(UIAccelerometer)</h3><ul><li><p>概述:<br>检测设备在<code>X/Y/Z轴</code>上的<code>受力</code>情况<br><img src="http://upload-images.jianshu.io/upload_images/590107-98de475675ae93b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="加速计"></p></li><li><p>监听方式:设置<code>代理</code></p></li><li><p>使用步骤:(iOS5之前)</p><ul><li><p>获取加速计<code>单例</code>对象:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UIAccelerometer</span> *accelerometer = [<span class="built_in">UIAccelerometer</span> sharedAccelerometer];</span><br></pre></td></tr></table></figure></li><li><p>设置加速计<code>代理</code>对象</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accelerometer.delegate = <span class="keyword">self</span>;</span><br></pre></td></tr></table></figure></li><li><p>设置<code>采样间隔</code> : <code>updateInterval</code></p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">accelerometer.updateInterval = <span class="number">0.3</span>;</span><br></pre></td></tr></table></figure></li><li><p>实现代理相关方法,监听加速计的数据</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)accelerometer:(<span class="built_in">UIAccelerometer</span> *)accelerometer didAccelerate:(<span class="built_in">UIAcceleration</span> *)acceleration;</span><br></pre></td></tr></table></figure></li><li><p><code>UIAcceleration</code> 参数:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIAcceleration</span> : <span class="title">NSObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">@private</span></span><br><span class="line">    <span class="built_in">NSTimeInterval</span> timestamp;</span><br><span class="line">    <span class="built_in">UIAccelerationValue</span> x, y, z;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>示例程序:</p></li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;ViewController.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UIAccelerometerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1.获取单例对象</span></span><br><span class="line">    <span class="built_in">UIAccelerometer</span> *accelerometer = [<span class="built_in">UIAccelerometer</span> sharedAccelerometer];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.设置代理</span></span><br><span class="line">    accelerometer.delegate = <span class="keyword">self</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.设置采样间隔</span></span><br><span class="line">    accelerometer.updateInterval = <span class="number">0.3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)accelerometer:(<span class="built_in">UIAccelerometer</span> *)accelerometer didAccelerate:(<span class="built_in">UIAcceleration</span> *)acceleration &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;x:%f y:%f z:%f&quot;</span>, acceleration.x, acceleration.y, acceleration.z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><ul><li>备注:<code>UIAcceleration</code>和<code>UIAccelerometer</code>在iOS 5.0中已经被弃用。由<code>Core Motion framework</code>取代。</li><li>官方提示信息:<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UIAcceleration and UIAccelerometer are deprecated as of iOS 5.0. These classes have been replaced by the Core Motion framework.</span><br></pre></td></tr></table></figure></li></ul><h3 id="三-Core-Motion"><a href="#三-Core-Motion" class="headerlink" title="三 . Core Motion"></a>三 . Core Motion</h3><ul><li>Core Motion获取数据的两种方式:<ul><li><code>push</code> : 实时采集所有数据,采集<code>频率高</code>;</li><li><code>pull</code> : 在有需要的时候,才去采集数据;</li></ul></li></ul><h6 id="Core-Motion的使用步骤—push"><a href="#Core-Motion的使用步骤—push" class="headerlink" title="Core Motion的使用步骤—push"></a>Core Motion的使用步骤—<code>push</code></h6><ul><li><p>1.创建运动管理对象</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CMMotionManager</span>*mgr = [[<span class="built_in">CMMotionManageralloc</span>]init];</span><br></pre></td></tr></table></figure></li><li><p>2.判断加速器是否可用(最好判断)</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(mgr.isAccelerometerAvailable)&#123;</span><br><span class="line">    <span class="comment">//加速计可用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>3.设置采样间隔</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mgr.accelerometerUpdateInterval= <span class="number">1.0</span>/<span class="number">30.0</span>;<span class="comment">// 1秒钟采样30次</span></span><br></pre></td></tr></table></figure></li><li><p>4.开始采样(采样到数据就会调用handler，handler会在queue中执行)</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)startAccelerometerUpdatesToQueue:(<span class="built_in">NSOperationQueue</span>*)queue withHandler:(<span class="built_in">CMAccelerometerHandler</span>)handler;</span><br></pre></td></tr></table></figure></li><li><p>示例程序:</p></li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;ViewController.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UIAccelerometerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 运动管理者 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CMMotionManager</span> *mgr; <span class="comment">// 保证不死</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - 懒加载</span></span><br><span class="line">- (<span class="built_in">CMMotionManager</span> *)mgr &#123;</span><br><span class="line">    <span class="keyword">if</span> (_mgr == <span class="literal">nil</span>) &#123;</span><br><span class="line">        _mgr = [[<span class="built_in">CMMotionManager</span> alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _mgr;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.判断加速计是否可用</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.mgr.isAccelerometerAvailable) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;加速计不可用&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.设置采样间隔</span></span><br><span class="line">    <span class="keyword">self</span>.mgr.accelerometerUpdateInterval = <span class="number">0.3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3.开始采样</span></span><br><span class="line">    [<span class="keyword">self</span>.mgr startAccelerometerUpdatesToQueue:[<span class="built_in">NSOperationQueue</span> mainQueue] withHandler:^(<span class="built_in">CMAccelerometerData</span> *accelerometerData, <span class="built_in">NSError</span> *error) &#123; <span class="comment">// 当采样到加速计信息时就会执行</span></span><br><span class="line">        <span class="keyword">if</span> (error) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4.获取加速计信息</span></span><br><span class="line">        <span class="built_in">CMAcceleration</span> acceleration = accelerometerData.acceleration;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;x:%f y:%f z:%f&quot;</span>, acceleration.x, acceleration.y, acceleration.z);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure><h6 id="Core-Motion的使用步骤—pull"><a href="#Core-Motion的使用步骤—pull" class="headerlink" title="Core Motion的使用步骤—pull"></a>Core Motion的使用步骤—<code>pull</code></h6><ul><li><p>说明 : <code>pull</code>是在需要时获取数据,我们此时以点击了屏幕就获取一次数据为例说明;</p></li><li><p>1.创建运动管理对象</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CMMotionManager</span>*mgr = [[<span class="built_in">CMMotionManageralloc</span>]init];</span><br></pre></td></tr></table></figure></li><li><p>2.判断加速器是否可用(最好判断)</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(mgr.isAccelerometerAvailable)&#123;</span><br><span class="line">    <span class="comment">//加速计可用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>3.开始采样</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(void)startAccelerometerUpdates;</span><br></pre></td></tr></table></figure></li><li><p>4.在需要时获取数据</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CMAcceleration</span> acc = mgr.accelerometerData.acceleration;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%f,%f, %f&quot;</span>, acc.x,acc.y,acc.z);</span><br></pre></td></tr></table></figure></li><li><p>示例程序:</p></li></ul><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;ViewController.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () &lt;<span class="title">UIAccelerometerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 运动管理者 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">CMMotionManager</span> *mgr; <span class="comment">// 保证不死</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - 懒加载</span></span><br><span class="line">- (<span class="built_in">CMMotionManager</span> *)mgr &#123;</span><br><span class="line">    <span class="keyword">if</span> (_mgr == <span class="literal">nil</span>) &#123;</span><br><span class="line">        _mgr = [[<span class="built_in">CMMotionManager</span> alloc] init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _mgr;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.判断加速计是否可用</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.mgr.isAccelerometerAvailable) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;加速计不可用&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.开始采样</span></span><br><span class="line">    [<span class="keyword">self</span>.mgr startAccelerometerUpdates];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.数据采样(以点击了屏幕为例说明)</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span> *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="comment">// 获取加速计信息</span></span><br><span class="line">    <span class="built_in">CMAcceleration</span> acceleration = <span class="keyword">self</span>.mgr.accelerometerData.acceleration;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;x:%f y:%f z:%f&quot;</span>, acceleration.x, acceleration.y, acceleration.z);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="四-磁力计-陀螺仪的使用和上述加速计的使用步骤类似"><a href="#四-磁力计-陀螺仪的使用和上述加速计的使用步骤类似" class="headerlink" title="四.磁力计/陀螺仪的使用和上述加速计的使用步骤类似"></a>四.磁力计/陀螺仪的使用和上述加速计的使用步骤类似</h4><p>不同点:</p><ul><li><p>1.判断传感器<code>是否可用</code>:</p><ul><li><p>加速计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isAccelerometerAvailable) <span class="built_in">BOOL</span> accelerometerAvailable;</span><br></pre></td></tr></table></figure></li><li><p>陀螺仪:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isGyroAvailable) <span class="built_in">BOOL</span> gyroAvailable;</span><br></pre></td></tr></table></figure></li><li><p>磁力计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isMagnetometerAvailable) <span class="built_in">BOOL</span> magnetometerAvailable</span><br></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>2.设置传感器的<code>采样间隔</code>:</p><ul><li><p>1.加速计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> accelerometerUpdateInterval;</span><br></pre></td></tr></table></figure></li><li><p>2.陀螺仪:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> gyroUpdateInterval;</span><br></pre></td></tr></table></figure></li><li><p>3.磁力计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span>(<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> magnetometerUpdateInterval</span><br></pre></td></tr></table></figure></li></ul></li><li><p>3.1.<code>开始采样</code>的方法–<code>push</code>:</p><ul><li><p>1.加速计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startAccelerometerUpdatesToQueue:(<span class="built_in">NSOperationQueue</span> *)queue withHandler:(<span class="built_in">CMAccelerometerHandler</span>)handler;</span><br></pre></td></tr></table></figure></li><li><p>2.陀螺仪:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startGyroUpdatesToQueue:(<span class="built_in">NSOperationQueue</span> *)queue withHandler:(<span class="built_in">CMGyroHandler</span>)handler;</span><br></pre></td></tr></table></figure></li><li><p>3.磁力计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startMagnetometerUpdatesToQueue:(<span class="built_in">NSOperationQueue</span> *)queue withHandler:(<span class="built_in">CMMagnetometerHandler</span>)handler;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>3.2.开发采样的方法–<code>pull</code></p><ul><li><p>1.加速计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startAccelerometerUpdates;</span><br></pre></td></tr></table></figure></li><li><p>2.陀螺仪:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startGyroUpdates;</span><br></pre></td></tr></table></figure></li><li><p>3.磁力计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)startMagnetometerUpdates;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>4.1获取采样数据–<code>push</code></p><ul><li>在对应的传感器的<code>开始采样</code>方法中的<code>handler</code>中;</li></ul></li><li><p>4.2.获取采样数据–<code>pull</code></p><ul><li><p>在需要获取的数据地方调用下面的方法:</p></li><li><p>加速计:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CMAcceleration</span> acceleration = <span class="keyword">self</span>.mgr.accelerometerData.acceleration;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;x:%f y:%f z:%f&quot;</span>, acceleration.x, acceleration.y, acceleration.z);</span><br></pre></td></tr></table></figure></li><li><p>陀螺仪:</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CMRotationRate</span> rate = <span class="keyword">self</span>.mgr.gyroData.rotationRate;</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;x:%f y:%f z:%f&quot;</span>, rate.x, rate.y, rate.z);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="五-没事你就-摇一摇"><a href="#五-没事你就-摇一摇" class="headerlink" title="五.没事你就,摇一摇"></a>五.没事你就,摇一摇</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)motionBegan:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;开始摇一摇&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)motionCancelled:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;摇一摇被取消&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)motionEnded:(<span class="built_in">UIEventSubtype</span>)motion withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;摇一摇停止&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="六-没事走两步-计步器"><a href="#六-没事走两步-计步器" class="headerlink" title="六. 没事走两步(计步器)"></a>六. 没事走两步(计步器)</h4><ul><li><p>1.判断计步器是否可用</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (![<span class="built_in">CMPedometer</span> isStepCountingAvailable]) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;计步器不可用&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>2.创建计步器对象</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CMPedometer</span> *stepCounter = [[<span class="built_in">CMPedometer</span> alloc] init];</span><br></pre></td></tr></table></figure></li><li><p>3.开始记步,并获取采样数据</p><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[stepCounter startPedometerUpdatesFromDate:[<span class="built_in">NSDate</span> date] withHandler:^(<span class="built_in">CMPedometerData</span> *pedometerData, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 4.获取采样数据</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;steps = %@&quot;</span>, pedometerData.numberOfSteps);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></li></ul><h4 id="七-蓝牙"><a href="#七-蓝牙" class="headerlink" title="七.蓝牙"></a>七.蓝牙</h4><ul><li><p>简述:<br>iOS中提供了4个框架用于实现蓝牙连接:</p><ul><li><p>1.<code>GameKit.framework</code></p><ul><li>只能用于<code>iOS设备之间</code>的连接，多用于游戏（比如五子棋对战）,可以在游戏中增加<code>对等连接</code>，又称<code>对端连接</code>或<code>点对点连接</code> <code>Peer To Peer</code>,从iOS7开始过期</li></ul></li><li><p>2.<code>MultipeerConnectivity.framework</code></p><ul><li>只能用于<code>iOS设备之间</code>的连接，从iOS7开始引入</li></ul></li><li><p>3.<code>ExternalAccessory.framework</code></p><ul><li>可用于<code>第三方蓝牙设备</code>交互，但是蓝牙设备必须经过<code>苹果MFi认证</code>（国内较少）</li></ul></li><li><p>4.<code>CoreBluetooth.framework</code>（时下热门）</p><ul><li>可用于<code>第三方蓝牙设备</code>交互，必须要支持蓝牙4.0;</li><li>硬件至少是4s，系统至少是iOS6;</li><li>蓝牙4.0以<code>低功耗</code>著称，一般也叫<code>BLE</code>（BluetoothLowEnergy）</li><li>目前应用比较多的案例：运动手坏、嵌入式设备、智能家居</li></ul></li></ul></li></ul></div><div class="post-copyright"><p class="copyright-item"> <span>Author:</span> <a href="http://yotrolz.com">YotrolZ</a></p><p class="copyright-item"> <span>Link:</span> <a href="http://yotrolz.com/posts/1ea19737/">http://yotrolz.com/posts/1ea19737/</a></p><p class="copyright-item"> <span>License:</span> <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a></p></div><footer class="post-footer"><nav class="post-nav"><a class="prev" href="/posts/428e23d5/"><i class="iconfont icon-left"></i> <span class="prev-text nav-default">iOS程序启动过程（生命周期）</span> <span class="prev-text nav-mobile">Prev</span></a> <a class="next" href="/posts/aec6074c/"><span class="next-text nav-default">神奇的IB_DESIGNABLE和IBInspectable(xib中设置圆角)</span> <span class="prev-text nav-mobile">Next</span><i class="iconfont icon-right"></i></a></nav></footer></article></div><div class="comments" id="comments"></div></div></main><footer id="footer" class="footer"><div class="social-links"></div><div class="copyright"> <span class="power-by">Powered by <a class="hexo-link" target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a></span> <span class="division">|</span> <span class="theme-info">Theme - <a class="theme-link" target="_blank" rel="noopener" href="https://github.com/ahonn/hexo-theme-even">Even</a></span> <span class="copyright-year">&copy;2015 - 2022<span class="heart"><i class="iconfont icon-heart"></i></span> <span class="author">YotrolZ</span></span></div></footer><div class="back-to-top" id="back-to-top"><i class="iconfont icon-up"></i></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/lib/jquery/jquery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/lib/slideout/slideout.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/lib/fancybox/jquery.fancybox.pack.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/yotrolz/yotrolz.github.io@gh/js/src/even.js?v=2.11.0"></script></body></html>